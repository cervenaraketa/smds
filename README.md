# Generated by M.A.D.S v3.0

## Project Information
- Generated on: 6. 6. 2025 19:54:00
- Prompt: "Prepiste kod odstrante tlacitko historie a vse co s tim souvisi s kodu a to same tlacitko inspect code take odstranit. Sprovoznete tlacitko napoveda a vymyslete napovedi co se uzivateli zobrazi. Dale pridejte kdyz si uzivatel vytvari system prompt tak aby tam byla dalsi moznost Output a tam se napise bud html, nebo css, nebo, js, nebo vse dohromady, tim se zajisti ze system prompt bude mit pouze tento vystup. index.html: <!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="AI Code Generation Interface ‚Äì Modern√≠ v√Ωvojov√© prost≈ôed√≠ pro AI-asistovan√© k√≥dov√°n√≠" />
  <title>AICODE STUDIO | Modern AI Code Generation</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <!-- Google AdSense -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXX" crossorigin="anonymous"></script>
  
  <!-- Custom Styles -->
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <a href="#main-content" class="skip-link">P≈ôej√≠t na hlavn√≠ obsah</a>

  <div class="app-container">
    <!-- TOP NAVIGATION -->
    <header class="top-nav">
      <div class="logo">
        <div class="logo-icon">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="url(#logo-gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M2 17L12 22L22 17" stroke="url(#logo-gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M2 12L12 17L22 12" stroke="url(#logo-gradient)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            <defs>
              <linearGradient id="logo-gradient" x1="2" y1="12" x2="22" y2="12" gradientUnits="userSpaceOnUse">
                <stop stop-color="#00FFCC" />
                <stop offset="0.5" stop-color="#9D4EDD" />
                <stop offset="1" stop-color="#FF36AB" />
              </linearGradient>
            </defs>
          </svg>
        </div>
        <h1>AICODE STUDIO</h1>
      </div>

      <!-- Model & Prompt Selectors -->
      <div class="topbar-selectors">
        <!-- Model Selector -->
        <div class="model-selector">
          <div class="model-display">
            <div class="model-status"><span class="status-indicator active"></span></div>
            <span class="model-name" id="currentModelName">deepseek-chat-v3-0324</span>
            <button class="model-dropdown-btn" aria-label="Vybrat AI model">
              <i class="fas fa-chevron-down"></i>
            </button>
          </div>
          <div class="model-dropdown" id="modelDropdown">
            <!-- Modely se naƒçtou dynamicky -->
          </div>
        </div>

        <!-- Prompt Selector -->
        <div class="prompt-selector">
          <div class="prompt-display">
            <span class="prompt-name" id="promptNameDisplay">v√Ωchoz√≠ prompt</span>
            <button class="prompt-dropdown-btn" id="promptDropdownBtn" aria-label="Vybrat system prompt">
              <i class="fas fa-chevron-down"></i>
            </button>
          </div>
          <div class="prompt-dropdown" id="promptDropdown">
            <!-- Prompty se naƒçtou dynamicky -->
          </div>
        </div>
      </div>

      <!-- User Controls -->
      <div class="user-controls">
        <button class="settings-btn" id="settingsBtn" aria-label="Nastaven√≠">
          <i class="fas fa-cog"></i>
        </button>
        <div class="user-avatar">
          <img src="https://ui-avatars.com/api/?name=Dev+User&background=8A2BE2&color=fff" alt="Avatar u≈æivatele" />
        </div>
      </div>
    </header>

    <!-- SIDEBAR -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-icons">
        <button class="sidebar-icon active" aria-label="Editor k√≥du" title="Editor k√≥du">
          <i class="fas fa-code"></i>
        </button>
        <button class="sidebar-icon" id="downloadBtn" aria-label="St√°hnout projekt" title="St√°hnout ZIP">
          <i class="fas fa-download"></i>
        </button>
        <button class="sidebar-icon" id="promptManagerBtn" aria-label="Spr√°va prompt≈Ø" title="Spr√°va prompt≈Ø">
          <i class="fas fa-file-alt"></i>
        </button>
        <button class="sidebar-icon" id="modelManagerBtn" aria-label="Spr√°va model≈Ø" title="Spr√°va model≈Ø">
          <i class="fas fa-robot"></i>
        </button>
        <button class="sidebar-icon" id="inspectBtn" aria-label="Inspect mode" title="Inspect Mode">
          <i class="fas fa-search"></i>
        </button>
        <button class="sidebar-icon" aria-label="Historie" title="Historie">
          <i class="fas fa-history"></i>
        </button>
      </div>
      
      <div class="sidebar-bottom">
        <div class="sidebar-balance">
          <div class="credit-circle">
            <div class="credit-inner">
              <div class="credit-amount" id="creditAmount">--.--</div>
              <div class="credit-unit">USD</div>
            </div>
          </div>
          <div class="credit-footer">
            <a href="https://openrouter.ai" target="_blank" rel="noopener">openrouter.ai</a>
          </div>
        </div>
        <button class="sidebar-icon" aria-label="N√°povƒõda" title="N√°povƒõda">
          <i class="fas fa-question-circle"></i>
        </button>
      </div>
    </aside>

    <!-- Resizer -->
    <div id="dragbar" class="dragbar" aria-hidden="true"></div>

    <!-- MAIN CONTENT -->
    <main id="main-content" class="main-content">
      <div class="editor-container">
        <!-- Prompt Panel (Left) -->
        <div class="prompt-left">
          <div class="prompt-input-container">
            <textarea id="aiPrompt" class="prompt-input" placeholder="Popi≈°te, co chcete vytvo≈ôit... (nap≈ô. 'Vytvo≈ôte responzivn√≠ landing page pro technologickou firmu...')"></textarea>
          </div>
          <div class="prompt-buttons">
            <button id="resetBtn" class="prompt-btn reset-btn" aria-label="Reset">
              <i class="fas fa-trash-alt"></i><span>Reset</span>
            </button>
            <button id="continueBtn" class="prompt-btn continue-btn" style="display:none;" aria-label="Pokraƒçovat v generov√°n√≠">
              <i class="fas fa-ellipsis-h"></i><span>Pokraƒçovat</span>
            </button>
            <button id="sendBtn" class="prompt-btn send-btn" aria-label="Odeslat prompt">
              <i class="fas fa-paper-plane"></i><span>Generovat</span>
            </button>
          </div>
        </div>

        <!-- Code Panel (Right) -->
        <div class="code-panel">
          <div class="editor-tabs">
            <button class="filename active" data-model="index">index.html</button>
            <button class="filename" data-model="style" style="display:none;">style.css</button>
            <button class="filename" data-model="script" style="display:none;">script.js</button>
            <button class="filename" data-model="thing" style="display:none;">thinking.txt</button>
          </div>

          <div id="editor" class="code-editor"></div>

          <div class="editor-status-bar">
            <div class="editor-status-left">
              <span class="editor-status-item">HTML</span>
              <span class="editor-status-item">UTF-8</span>
            </div>
            <div class="editor-status-right">
              <button id="toggleAutoUpdateBtn" class="editor-status-btn active" title="P≈ôepnout automatick√© aktualizace">
                <i class="fas fa-sync-alt"></i><span>Auto Update</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Resize Bar -->
      <div id="resizeBar" class="resize-bar" aria-hidden="true"></div>

      <!-- Preview Container -->
      <div class="preview-container">
        <div class="preview-header">
          <h3>Live Preview</h3>
          <div class="preview-controls">
            <button class="preview-control-btn" id="refreshPreviewBtn" aria-label="Obnovit n√°hled">
              <i class="fas fa-sync-alt"></i>
            </button>
            <button class="preview-control-btn" id="openNewWindowBtn" aria-label="Otev≈ô√≠t v nov√©m oknƒõ">
              <i class="fas fa-external-link-alt"></i>
            </button>
            <button class="preview-control-btn" id="toggleDeviceBtn" aria-label="P≈ôepnout zobrazen√≠ za≈ô√≠zen√≠">
              <i class="fas fa-mobile-alt"></i>
            </button>
          </div>
        </div>
        <div class="preview-frame-wrapper">
          <svg class="snake-border-svg" preserveAspectRatio="none">
            <rect x="1" y="1" />
            <rect x="1" y="1" />
          </svg>
          <iframe id="renderFrame" class="preview-frame" title="N√°hled k√≥du" sandbox="allow-scripts allow-same-origin"></iframe>
          <div class="preview-loading">
            <div class="preview-loading-spinner"></div>
          </div>
        </div>
      </div>

      <!-- Google Ads Panel -->
      <div class="ads-panel">
        <div class="ads-header">
          <span>Reklama</span>
          <button class="ads-minimize" id="adsMinimizeBtn" aria-label="Minimalizovat reklamy">
            <i class="fas fa-minus"></i>
          </button>
        </div>
        <div class="ads-content" id="adsContent">
          <!-- Google AdSense Banner -->
          <ins class="adsbygoogle ads-banner"
               style="display:block"
               data-ad-client="ca-pub-XXXXXXXXXX"
               data-ad-slot="XXXXXXXXXX"
               data-ad-format="auto"
               data-full-width-responsive="true"></ins>
          
          <!-- Fallback reklama -->
          <div class="fallback-ad">
            <div class="fallback-ad-content">
              <h4>Podpo≈ôte v√Ωvoj</h4>
              <p>Tento n√°stroj je zdarma d√≠ky reklam√°m</p>
              <a href="#" class="fallback-ad-link">Zjistit v√≠ce</a>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- MODALS -->
  
  <!-- Settings Modal -->
  <div id="settingsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Nastaven√≠ AI</h2>
        <button class="modal-close" aria-label="Zav≈ô√≠t">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="settings-section">
          <h3>Parametry modelu</h3>
          <div class="setting-group">
            <label for="temperatureSlider">Teplota (Temperature): <span id="temperatureValue">0.7</span></label>
            <input type="range" id="temperatureSlider" min="0" max="2" step="0.1" value="0.7" class="slider">
          </div>
          <div class="setting-group">
            <label for="maxTokensInput">Maxim√°ln√≠ tokeny:</label>
            <input type="number" id="maxTokensInput" min="100" max="100000" value="50000" class="number-input">
          </div>
          <div class="setting-group">
            <label for="topPSlider">Top P: <span id="topPValue">1.0</span></label>
            <input type="range" id="topPSlider" min="0" max="1" step="0.05" value="1.0" class="slider">
          </div>
          <div class="setting-group">
            <label for="frequencyPenaltySlider">Frequency Penalty: <span id="frequencyPenaltyValue">0.0</span></label>
            <input type="range" id="frequencyPenaltySlider" min="0" max="2" step="0.1" value="0.0" class="slider">
          </div>
        </div>
        
        <div class="settings-section">
          <h3>API nastaven√≠</h3>
          <div class="setting-group">
            <label for="apiKeyInput">OpenRouter API kl√≠ƒç:</label>
            <input type="password" id="apiKeyInput" placeholder="sk-or-v1-..." class="text-input">
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button id="saveSettingsBtn" class="btn btn-primary">Ulo≈æit nastaven√≠</button>
        <button id="cancelSettingsBtn" class="btn btn-secondary">Zru≈°it</button>
      </div>
    </div>
  </div>

  <!-- Prompt Manager Modal -->
  <div id="promptManagerModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Spr√°va System Prompt≈Ø</h2>
        <button class="modal-close" aria-label="Zav≈ô√≠t">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="prompt-manager-toolbar">
          <button id="createPromptBtn" class="btn btn-primary">
            <i class="fas fa-plus"></i> Nov√Ω prompt
          </button>
          <button id="importPromptBtn" class="btn btn-secondary">
            <i class="fas fa-upload"></i> Importovat JSON
          </button>
          <input type="file" id="promptFileInput" accept=".json" style="display: none;">
        </div>
        
        <div class="prompt-list" id="promptList">
          <!-- Prompty se naƒçtou dynamicky -->
        </div>
        
        <div class="prompt-editor" id="promptEditor" style="display: none;">
          <div class="prompt-editor-header">
            <input type="text" id="promptNameInput" placeholder="N√°zev promptu" class="text-input">
            <div class="prompt-editor-actions">
              <button id="savePromptBtn" class="btn btn-primary">Ulo≈æit</button>
              <button id="exportPromptBtn" class="btn btn-secondary">Exportovat JSON</button>
              <button id="cancelPromptBtn" class="btn btn-secondary">Zru≈°it</button>
            </div>
          </div>
          <textarea id="promptContentInput" placeholder="Zadejte system prompt..." class="prompt-textarea"></textarea>
        </div>
      </div>
    </div>
  </div>

  <!-- Model Manager Modal -->
  <div id="modelManagerModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Spr√°va AI Model≈Ø</h2>
        <button class="modal-close" aria-label="Zav≈ô√≠t">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="model-manager-toolbar">
          <div class="add-model-form">
            <input type="text" id="newModelInput" placeholder="openai/gpt-4o, anthropic/claude-3-sonnet..." class="text-input">
            <button id="addModelBtn" class="btn btn-primary">
              <i class="fas fa-plus"></i> P≈ôidat model
            </button>
          </div>
        </div>
        
        <div class="model-list" id="modelList">
          <!-- Modely se naƒçtou dynamicky -->
        </div>
      </div>
    </div>
  </div>

  <!-- Notifications -->
  <div class="notifications-container" id="notificationsContainer">
    <!-- Notifikace se p≈ôid√°vaj√≠ dynamicky -->
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.46.0/min/vs/loader.min.js"></script>
  <script src="script.js"></script>
  
  <!-- Google AdSense Script -->
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</body>
</html> script.js: // ==========================================
// AICODE STUDIO - Optimized Version
// ==========================================

// ==========================================
// 1. KONFIGURACE A GLOB√ÅLN√ç PROMƒöNN√â
// ==========================================

const API_URL = 'https://openrouter.ai/api/v1/chat/completions';
let API_KEY = localStorage.getItem('openrouter_api_key') || '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';

// AI nastaven√≠
let aiSettings = {
    temperature: 0.7,
    maxTokens: 50000,
    topP: 1.0,
    frequencyPenalty: 0.0
};

// Aktu√°ln√≠ model a prompt
let currentModel = 'deepseek/deepseek-chat-v3-0324';
let currentPrompt = '';

// Monaco editor instance
let editor, indexModel, thingModel;   // styleModel & scriptModel pryƒç

// Buffery pro r≈Øzn√© soubory
let htmlBuffer = '';
let insideHtmlDoc = false;   // sleduje, jestli u≈æ jsme ‚Äúuvnit≈ô‚Äù dokumentu



// Stav aplikace
let autoUpdateEnabled = true;
let isGenerating = false;
let conversation = [];

// DOM elementy - optimalizovan√© cachov√°n√≠
const elements = {};

// ==========================================
// 2. INICIALIZACE APLIKACE - OPTIMALIZOV√ÅNO
// ==========================================

document.addEventListener('DOMContentLoaded', () => {
    // Rychl√© cachov√°n√≠ v≈°ech element≈Ø najednou
    cacheElements();
    
    // Paraleln√≠ inicializace
    Promise.all([
        initializeMonacoEditor(),
        loadSettings(),
        loadModels(),
        loadPrompts()
    ]).then(() => {
        initializeEventListeners();
        updateCreditBalance();
        initializeSnakeBorder();
        initializeAds();
    }).catch(error => {
        console.error('Chyba p≈ôi inicializaci:', error);
        showNotification('error', 'Chyba inicializace', 'Aplikace se nemus√≠ chovat spr√°vnƒõ');
    });
});

function cacheElements() {
    // Batch DOM queries pro lep≈°√≠ v√Ωkon
    const selectors = {
        aiPrompt: '#aiPrompt',
        sendBtn: '#sendBtn',
        resetBtn: '#resetBtn',
        continueBtn: '#continueBtn',
        renderFrame: '#renderFrame',
        settingsModal: '#settingsModal',
        promptManagerModal: '#promptManagerModal',
        modelManagerModal: '#modelManagerModal',
        modelDropdown: '#modelDropdown',
        promptDropdown: '#promptDropdown',
        creditAmount: '#creditAmount',
        notificationsContainer: '#notificationsContainer'
    };
    
    Object.entries(selectors).forEach(([key, selector]) => {
        elements[key] = document.querySelector(selector);
    });
}

// ==========================================
// 3. MONACO EDITOR - OPTIMALIZOV√ÅNO
// ==========================================

function initializeMonacoEditor() {
    return new Promise((resolve, reject) => {
        require.config({ 
            paths: { 
                vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.46.0/min/vs' 
            } 
        });
        
        require(['vs/editor/editor.main'], () => {
            try {
                // Definice tmav√©ho t√©matu
                monaco.editor.defineTheme('aicode-dark', {
                    base: 'vs-dark',
                    inherit: true,
                    rules: [
                        { token: 'comment', foreground: '6A9955' },
                        { token: 'keyword', foreground: '569CD6' },
                        { token: 'string', foreground: 'CE9178' },
                        { token: 'number', foreground: 'B5CEA8' }
                    ],
                    colors: {
                        'editor.background': '#000000',
                        'editor.foreground': '#ffffff',
                        'minimap.background': '#000000',
                        'scrollbarSlider.background': '#66666650',
                        'scrollbarSlider.hoverBackground': '#88888870',
                        'scrollbarSlider.activeBackground': '#aaaaaa80'
                    }
                });

// Jedin√Ω model pro index.html
 indexModel = monaco.editor.createModel(
     getDefaultHTML(),
     'html',
     monaco.Uri.parse('file:///index.html')
 );
                

                
                thingModel = monaco.editor.createModel(
                    '', 
                    'plaintext', 
                    monaco.Uri.parse('file:///thinking.txt')
                );

                // Vytvo≈ôen√≠ editoru s optimalizovan√Ωmi nastaven√≠mi
                editor = monaco.editor.create(document.getElementById('editor'), {
                    model: indexModel,
                    theme: 'aicode-dark',
                    automaticLayout: true,
                    fontFamily: 'Fira Code',
                    fontSize: 14,
                    minimap: { 
                        enabled: true, 
                        showSlider: 'always', 
                        renderCharacters: false, 
                        maxColumn: 120 
                    },
                    scrollbar: { 
                        verticalScrollbarSize: 14, 
                        verticalSliderSize: 14,
                        useShadows: false, // Optimalizace v√Ωkonu
                        verticalHasArrows: false,
                        horizontalHasArrows: false
                    },
                    wordWrap: 'on',
                    cursorBlinking: 'solid',
                    cursorSmoothCaretAnimation: 'off', // Optimalizace v√Ωkonu
                    suggestOnTriggerCharacters: true,
                    quickSuggestions: true,
                    parameterHints: { enabled: true },
                    // Optimalizace v√Ωkonu
                    renderLineHighlight: 'line',
                    renderWhitespace: 'none',
                    smoothScrolling: false
                });

                // Optimalizovan√Ω event listener s debouncing
                let updateTimeout;
                editor.onDidChangeModelContent(() => {
                    clearTimeout(updateTimeout);
                    updateTimeout = setTimeout(() => {
                        const currentModel = editor.getModel();
                          htmlBuffer = editor.getValue();
    updatePreview();
                    }, 300); // Debounce 300ms
                });

                // Inicializace s v√Ωchoz√≠m obsahem
                htmlBuffer = indexModel.getValue();
                updatePreview();
                
                resolve();
            } catch (error) {
                reject(error);
            }
        });
    });
}

function getDefaultHTML() {
    return `<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nov√Ω projekt</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 500px;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        p {
            color: #666;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ V√≠tejte v AICODE STUDIO</h1>
        <p>Zaƒçnƒõte ps√°t prompt vlevo a sledujte, jak se v√°≈° k√≥d vytv√°≈ô√≠ v re√°ln√©m ƒçase!</p>
    </div>
</body>
</html>`;
}

// ==========================================
// 4. EVENT LISTENERS - OPTIMALIZOV√ÅNO
// ==========================================

function initializeEventListeners() {
    // Hlavn√≠ tlaƒç√≠tka
    elements.sendBtn?.addEventListener('click', generateCode);
    elements.resetBtn?.addEventListener('click', resetEditor);
    elements.continueBtn?.addEventListener('click', continueGeneration);
    
    // Optimalizovan√Ω keyboard handler
    elements.aiPrompt?.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            generateCode();
        }
    });
    
    // Batch event listeners pro sidebar
    const sidebarButtons = [
        { id: 'downloadBtn', handler: downloadProject },
        { id: 'settingsBtn', handler: () => openModal('settings') },
        { id: 'promptManagerBtn', handler: () => openModal('promptManager') },
        { id: 'modelManagerBtn', handler: () => openModal('modelManager') },
        { id: 'toggleAutoUpdateBtn', handler: toggleAutoUpdate }
    ];
    
    sidebarButtons.forEach(({ id, handler }) => {
        document.getElementById(id)?.addEventListener('click', handler);
    });
    
    // Optimalizovan√© tab switching
    document.querySelectorAll('.filename').forEach(tab => {
        tab.addEventListener('click', () => switchEditorTab(tab));
    });
    
    // Preview controls
    document.getElementById('refreshPreviewBtn')?.addEventListener('click', updatePreview);
    document.getElementById('openNewWindowBtn')?.addEventListener('click', openPreviewInNewWindow);
    
    // Modal event listeners
    initializeModalListeners();
    
    // Dropdown listeners
    initializeDropdownListeners();
    
    // Resize listeners
    initializeResizeListeners();
    
    // Ads minimize
    document.getElementById('adsMinimizeBtn')?.addEventListener('click', toggleAds);
}

function initializeModalListeners() {
    // Optimalizovan√© modal handling
    document.querySelectorAll('.modal-close').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const modal = e.target.closest('.modal');
            closeModal(modal.id);
        });
    });
    
    // Optimalizovan√© click outside handling
    document.querySelectorAll('.modal').forEach(modal => {
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal(modal.id);
            }
        });
    });
    
    // Settings modal
    document.getElementById('saveSettingsBtn')?.addEventListener('click', saveSettings);
    document.getElementById('cancelSettingsBtn')?.addEventListener('click', () => closeModal('settingsModal'));
    
    // Prompt manager modal
    document.getElementById('createPromptBtn')?.addEventListener('click', createNewPrompt);
    document.getElementById('importPromptBtn')?.addEventListener('click', () => {
        document.getElementById('promptFileInput').click();
    });
    document.getElementById('promptFileInput')?.addEventListener('change', importPrompt);
    document.getElementById('savePromptBtn')?.addEventListener('click', savePrompt);
    document.getElementById('exportPromptBtn')?.addEventListener('click', exportPrompt);
    document.getElementById('cancelPromptBtn')?.addEventListener('click', cancelPromptEdit);
    
    // Model manager modal
    document.getElementById('addModelBtn')?.addEventListener('click', addNewModel);
    
    // Optimalizovan√© slider handling
    const sliders = ['temperature', 'topP', 'frequencyPenalty'];
    sliders.forEach(setting => {
        const slider = document.getElementById(`${setting}Slider`);
        const valueDisplay = document.getElementById(`${setting}Value`);
        if (slider && valueDisplay) {
            slider.addEventListener('input', (e) => {
                valueDisplay.textContent = e.target.value;
            });
        }
    });
}

function initializeDropdownListeners() {
    // Optimalizovan√© dropdown handling
    const modelSelector = document.querySelector('.model-selector');
    const modelDropdownBtn = document.querySelector('.model-dropdown-btn');
    
    modelDropdownBtn?.addEventListener('click', (e) => {
        e.stopPropagation();
        modelSelector.classList.toggle('open');
        document.querySelector('.prompt-selector')?.classList.remove('open');
    });
    
    const promptSelector = document.querySelector('.prompt-selector');
    const promptDropdownBtn = document.getElementById('promptDropdownBtn');
    
    promptDropdownBtn?.addEventListener('click', (e) => {
        e.stopPropagation();
        promptSelector.classList.toggle('open');
        modelSelector?.classList.remove('open');
    });
    
    // Optimalizovan√© click outside
    document.addEventListener('click', () => {
        modelSelector?.classList.remove('open');
        promptSelector?.classList.remove('open');
    });
}

function initializeResizeListeners() {
    // ‚Ä¶ (p≈ôedchoz√≠ ƒç√°st init sidebaru) ‚Ä¶

    // Main content resizer (plynul√© p≈ôenastavov√°n√≠ pomoc√≠ requestAnimationFrame)
    const resizeBar = document.getElementById('resizeBar');
    const editorContainer = document.querySelector('.editor-container');
    const previewContainer = document.querySelector('.preview-container');

    if (resizeBar && editorContainer && previewContainer) {
        let startX, startEditorWidth, startPreviewWidth;
        let isResizing = false;
        let lastClientX = 0;
        let rAFid = null;

        const onPointerMove = (e) => {
            // Ulo≈æ√≠me si nejnovƒõj≈°√≠ pozici my≈°i; skuteƒçnou zmƒõnu provedeme v loopu rAF
            lastClientX = e.clientX;
        };

        const doResize = () => {
            if (!isResizing) {
                rAFid = null;
                return;
            }

            const delta = lastClientX - startX;
            const newEditorWidth = Math.max(300, startEditorWidth + delta);
            const newPreviewWidth = Math.max(300, startPreviewWidth - delta);

            editorContainer.style.flexBasis = newEditorWidth + 'px';
            previewContainer.style.flexBasis = newPreviewWidth + 'px';

            // Napl√°nujeme dal≈°√≠ iteraci, pokud st√°le dr≈æ√≠me resize
            rAFid = requestAnimationFrame(doResize);
        };

        resizeBar.addEventListener('pointerdown', (e) => {
            e.preventDefault();
            isResizing = true;
            startX = e.clientX;

            // Zachyt√≠me, kde byly ≈°√≠≈ôky p≈ôi zaƒç√°tku
            const editorRect = editorContainer.getBoundingClientRect();
            const previewRect = previewContainer.getBoundingClientRect();
            startEditorWidth = editorRect.width;
            startPreviewWidth = previewRect.width;

            // Zajist√≠me, ≈æe ‚Äûpointerup‚Äú se zachyt√≠ i mimo element
            resizeBar.setPointerCapture(e.pointerId);

            // Napoj√≠me move listener a spust√≠me prvn√≠ rAF
            resizeBar.addEventListener('pointermove', onPointerMove);
            rAFid = requestAnimationFrame(doResize);
        });

        resizeBar.addEventListener('pointerup', (e) => {
            isResizing = false;
            resizeBar.releasePointerCapture(e.pointerId);

            // Odebereme listener na pohyb my≈°i
            resizeBar.removeEventListener('pointermove', onPointerMove);

            // Zastav√≠me p≈ô√≠padn√© napl√°novan√© rAF
            if (rAFid !== null) {
                cancelAnimationFrame(rAFid);
                rAFid = null;
            }
        });

        // Pro jistotu o≈°et≈ô√≠me i pointercancel (nap≈ô. ESC ƒçi ztr√°ta fokusu)
        resizeBar.addEventListener('pointercancel', (e) => {
            isResizing = false;
            resizeBar.releasePointerCapture(e.pointerId);
            resizeBar.removeEventListener('pointermove', onPointerMove);
            if (rAFid !== null) {
                cancelAnimationFrame(rAFid);
                rAFid = null;
            }
        });
    }
}


// Throttle helper function
function throttle(func, limit) {
    let inThrottle;
    return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    }
}

// ==========================================
// 5. SPR√ÅVA MODEL≈Æ - OPTIMALIZOV√ÅNO
// ==========================================

function loadModels() {
    const savedModels = JSON.parse(localStorage.getItem('aicode_models') || '[]');
    const defaultModels = [
        { id: 'deepseek/deepseek-chat-v3-0324', name: 'DeepSeek V3 0324', provider: 'DeepSeek', premium: true },
        { id: 'deepseek/deepseek-chat', name: 'DeepSeek Chat', provider: 'DeepSeek', premium: true },
        { id: 'deepseek/deepseek-r1', name: 'DeepSeek R1', provider: 'DeepSeek', premium: true },
        { id: 'openai/gpt-4o', name: 'GPT-4o', provider: 'OpenAI', premium: true },
        { id: 'openai/gpt-4o-mini', name: 'GPT-4o Mini', provider: 'OpenAI', premium: false },
        { id: 'anthropic/claude-3-5-sonnet', name: 'Claude 3.5 Sonnet', provider: 'Anthropic', premium: true },
        { id: 'anthropic/claude-3-haiku', name: 'Claude 3 Haiku', provider: 'Anthropic', premium: false },
        { id: 'x-ai/grok-beta', name: 'Grok Beta', provider: 'xAI', premium: true }
    ];
    
    const allModels = [...defaultModels, ...savedModels];
    renderModelDropdown(allModels);
    renderModelManager(allModels);
    
    // Nastaven√≠ aktu√°ln√≠ho modelu
    const savedCurrentModel = localStorage.getItem('aicode_current_model');
    if (savedCurrentModel && allModels.find(m => m.id === savedCurrentModel)) {
        selectModel(savedCurrentModel);
    }
}

function renderModelDropdown(models) {
    if (!elements.modelDropdown) return;
    
    // Optimalizovan√© rendering pomoc√≠ DocumentFragment
    const fragment = document.createDocumentFragment();
    
    models.forEach(model => {
        const option = document.createElement('div');
        option.className = 'model-option';
        option.dataset.model = model.id;
        option.innerHTML = `
            <span class="model-option-name">${model.name}</span>
            ${model.premium ? '<span class="model-option-tag">Premium</span>' : ''}
        `;
        
        option.addEventListener('click', (e) => {
            e.stopPropagation();
            selectModel(model.id);
            document.querySelector('.model-selector').classList.remove('open');
        });
        
        fragment.appendChild(option);
    });
    
    elements.modelDropdown.innerHTML = '';
    elements.modelDropdown.appendChild(fragment);
}

function renderModelManager(models) {
    const modelList = document.getElementById('modelList');
    if (!modelList) return;
    
    // Optimalizovan√© rendering
    const fragment = document.createDocumentFragment();
    
    models.forEach(model => {
        const item = document.createElement('div');
        item.className = 'model-item';
        item.dataset.model = model.id;
        item.innerHTML = `
            <div class="model-item-info">
                <div class="model-item-name">${model.name}</div>
                <div class="model-item-provider">${model.provider} ‚Ä¢ ${model.id}</div>
            </div>
            <div class="model-item-actions">
                <button class="model-item-btn" onclick="selectModel('${model.id}')" title="Vybrat model">
                    <i class="fas fa-check"></i>
                </button>
                ${!isDefaultModel(model.id) ? `
                    <button class="model-item-btn delete" onclick="removeModel('${model.id}')" title="Odstranit model">
                        <i class="fas fa-trash"></i>
                    </button>
                ` : ''}
            </div>
        `;
        fragment.appendChild(item);
    });
    
    modelList.innerHTML = '';
    modelList.appendChild(fragment);
}

function selectModel(modelId) {
    currentModel = modelId;
    localStorage.setItem('aicode_current_model', modelId);
    
    // Optimalizovan√© UI update
    const modelName = document.getElementById('currentModelName');
    const selectedModel = getModelById(modelId);
    if (modelName && selectedModel) {
        modelName.textContent = selectedModel.name;
    }
    
    // Optimalizovan√© oznaƒçen√≠ vybran√©ho modelu
    document.querySelectorAll('.model-option').forEach(option => {
        option.classList.toggle('selected', option.dataset.model === modelId);
    });
    
    showNotification('success', 'Model zmƒõnƒõn', `Vybr√°n model: ${selectedModel?.name || modelId}`);
}

function addNewModel() {
    const input = document.getElementById('newModelInput');
    const modelId = input.value.trim();
    
    if (!modelId) {
        showNotification('error', 'Chyba', 'Zadejte ID modelu');
        return;
    }
    
    if (!modelId.includes('/')) {
        showNotification('error', 'Chyba', 'ID modelu mus√≠ b√Ωt ve form√°tu provider/model');
        return;
    }
    
    const [provider, name] = modelId.split('/');
    const newModel = {
        id: modelId,
        name: name.replace(/-/g, ' ').replace(/\b\w/g, l => l.toUpperCase()),
        provider: provider.charAt(0).toUpperCase() + provider.slice(1),
        premium: false
    };
    
    const savedModels = JSON.parse(localStorage.getItem('aicode_models') || '[]');
    if (savedModels.find(m => m.id === modelId)) {
        showNotification('error', 'Chyba', 'Model ji≈æ existuje');
        return;
    }
    
    savedModels.push(newModel);
    localStorage.setItem('aicode_models', JSON.stringify(savedModels));
    
    input.value = '';
    loadModels();
    showNotification('success', 'Model p≈ôid√°n', `Model ${newModel.name} byl √∫spƒõ≈°nƒõ p≈ôid√°n`);
}

function removeModel(modelId) {
    if (isDefaultModel(modelId)) {
        showNotification('error', 'Chyba', 'Nelze odstranit v√Ωchoz√≠ model');
        return;
    }
    
    const savedModels = JSON.parse(localStorage.getItem('aicode_models') || '[]');
    const filteredModels = savedModels.filter(m => m.id !== modelId);
    localStorage.setItem('aicode_models', JSON.stringify(filteredModels));
    
    loadModels();
    showNotification('success', 'Model odstranƒõn', 'Model byl √∫spƒõ≈°nƒõ odstranƒõn');
}

function getModelById(modelId) {
    const savedModels = JSON.parse(localStorage.getItem('aicode_models') || '[]');
    const defaultModels = [
        { id: 'deepseek/deepseek-chat-v3-0324', name: 'DeepSeek V3 0324', provider: 'DeepSeek' },
        { id: 'openai/gpt-4o', name: 'GPT-4o', provider: 'OpenAI' }
    ];
    
    return [...defaultModels, ...savedModels].find(m => m.id === modelId);
}

function isDefaultModel(modelId) {
    const defaultModelIds = [
        'deepseek/deepseek-chat-v3-0324',
        'deepseek/deepseek-chat',
        'deepseek/deepseek-r1',
        'openai/gpt-4o',
        'openai/gpt-4o-mini',
        'anthropic/claude-3-5-sonnet',
        'anthropic/claude-3-haiku',
        'x-ai/grok-beta'
    ];
    return defaultModelIds.includes(modelId);
}

// ==========================================
// 6. SPR√ÅVA PROMPT≈Æ - OPTIMALIZOV√ÅNO
// ==========================================

function loadPrompts() {
    const savedPrompts = JSON.parse(localStorage.getItem('aicode_prompts') || '[]');
    const defaultPrompts = [
        {
            id: 'website',
            name: 'Webov√° str√°nka',
            content: 'Jsi expertn√≠ webov√Ω v√Ωvoj√°≈ô. Vytvo≈ô modern√≠, responzivn√≠ webovou str√°nku podle zad√°n√≠ u≈æivatele. Pou≈æ√≠vej nejnovƒõj≈°√≠ HTML5, CSS3 a JavaScript. K√≥d mus√≠ b√Ωt ƒçist√Ω, s√©mantick√Ω a p≈ô√≠stupn√Ω.'
        },
        {
            id: 'game',
            name: 'Hra',
            content: 'Jsi expertn√≠ hern√≠ v√Ωvoj√°≈ô. Vytvo≈ô interaktivn√≠ hru podle zad√°n√≠ u≈æivatele. Pou≈æ√≠vej HTML5 Canvas nebo CSS pro grafiku a JavaScript pro logiku. Hra mus√≠ b√Ωt z√°bavn√° a funkƒçn√≠.'
        },
        {
            id: 'app',
            name: 'Webov√° aplikace',
            content: 'Jsi expertn√≠ frontend v√Ωvoj√°≈ô. Vytvo≈ô funkƒçn√≠ webovou aplikaci podle zad√°n√≠ u≈æivatele. Pou≈æ√≠vej modern√≠ JavaScript, CSS Grid/Flexbox a zajisti dobrou u≈æivatelskou zku≈°enost.'
        }
    ];
    
    const allPrompts = [...defaultPrompts, ...savedPrompts];
    renderPromptDropdown(allPrompts);
    renderPromptManager(allPrompts);
    
    // Nastaven√≠ aktu√°ln√≠ho promptu
    const savedCurrentPrompt = localStorage.getItem('aicode_current_prompt');
    if (savedCurrentPrompt) {
        const prompt = allPrompts.find(p => p.id === savedCurrentPrompt);
        if (prompt) {
            selectPrompt(prompt.id);
        }
    } else if (allPrompts.length > 0) {
        selectPrompt(allPrompts[0].id);
    }
}

function renderPromptDropdown(prompts) {
    if (!elements.promptDropdown) return;
    
    // Optimalizovan√© rendering
    const fragment = document.createDocumentFragment();
    
    prompts.forEach(prompt => {
        const option = document.createElement('div');
        option.className = 'prompt-option';
        option.dataset.prompt = prompt.id;
        option.innerHTML = `<span class="prompt-option-name">${prompt.name}</span>`;
        
        option.addEventListener('click', (e) => {
            e.stopPropagation();
            selectPrompt(prompt.id);
            document.querySelector('.prompt-selector').classList.remove('open');
        });
        
        fragment.appendChild(option);
    });
    
    elements.promptDropdown.innerHTML = '';
    elements.promptDropdown.appendChild(fragment);
}

function renderPromptManager(prompts) {
    const promptList = document.getElementById('promptList');
    if (!promptList) return;
    
    // Optimalizovan√© rendering
    const fragment = document.createDocumentFragment();
    
    prompts.forEach(prompt => {
        const item = document.createElement('div');
        item.className = 'prompt-item';
        item.dataset.prompt = prompt.id;
        item.innerHTML = `
            <span class="prompt-item-name">${prompt.name}</span>
            <div class="prompt-item-actions">
                <button class="prompt-item-btn" onclick="editPrompt('${prompt.id}')" title="Upravit">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="prompt-item-btn" onclick="exportSinglePrompt('${prompt.id}')" title="Exportovat">
                    <i class="fas fa-download"></i>
                </button>
                ${!isDefaultPrompt(prompt.id) ? `
                    <button class="prompt-item-btn" onclick="removePrompt('${prompt.id}')" title="Odstranit">
                        <i class="fas fa-trash"></i>
                    </button>
                ` : ''}
            </div>
        `;
        fragment.appendChild(item);
    });
    
    promptList.innerHTML = '';
    promptList.appendChild(fragment);
}

function selectPrompt(promptId) {
    const prompts = JSON.parse(localStorage.getItem('aicode_prompts') || '[]');
    const defaultPrompts = [
        { id: 'website', name: 'Webov√° str√°nka', content: 'Jsi expertn√≠ webov√Ω v√Ωvoj√°≈ô. Vytvo≈ô modern√≠, responzivn√≠ webovou str√°nku podle zad√°n√≠ u≈æivatele. Pou≈æ√≠vej nejnovƒõj≈°√≠ HTML5, CSS3 a JavaScript. K√≥d mus√≠ b√Ωt ƒçist√Ω, s√©mantick√Ω a p≈ô√≠stupn√Ω.' },
        { id: 'game', name: 'Hra', content: 'Jsi expertn√≠ hern√≠ v√Ωvoj√°≈ô. Vytvo≈ô interaktivn√≠ hru podle zad√°n√≠ u≈æivatele. Pou≈æ√≠vej HTML5 Canvas nebo CSS pro grafiku a JavaScript pro logiku. Hra mus√≠ b√Ωt z√°bavn√° a funkƒçn√≠.' },
        { id: 'app', name: 'Webov√° aplikace', content: 'Jsi expertn√≠ frontend v√Ωvoj√°≈ô. Vytvo≈ô funkƒçn√≠ webovou aplikaci podle zad√°n√≠ u≈æivatele. Pou≈æ√≠vej modern√≠ JavaScript, CSS Grid/Flexbox a zajisti dobrou u≈æivatelskou zku≈°enost.' }
    ];
    
    const allPrompts = [...defaultPrompts, ...prompts];
    const prompt = allPrompts.find(p => p.id === promptId);
    
    if (prompt) {
        currentPrompt = prompt.content;
        localStorage.setItem('aicode_current_prompt', promptId);
        
        // Optimalizovan√© UI update
        const promptNameDisplay = document.getElementById('promptNameDisplay');
        if (promptNameDisplay) {
            promptNameDisplay.textContent = prompt.name;
        }
        
        // Optimalizovan√© oznaƒçen√≠ vybran√©ho promptu
        document.querySelectorAll('.prompt-option').forEach(option => {
            option.classList.toggle('selected', option.dataset.prompt === promptId);
        });
    }
}

function createNewPrompt() {
    document.getElementById('promptNameInput').value = '';
    document.getElementById('promptContentInput').value = '';
    document.getElementById('promptEditor').style.display = 'block';
    document.getElementById('promptList').style.display = 'none';
}

function editPrompt(promptId) {
    const prompts = getAllPrompts();
    const prompt = prompts.find(p => p.id === promptId);
    
    if (prompt) {
        document.getElementById('promptNameInput').value = prompt.name;
        document.getElementById('promptContentInput').value = prompt.content;
        document.getElementById('promptEditor').style.display = 'block';
        document.getElementById('promptList').style.display = 'none';
        document.getElementById('promptEditor').dataset.editingId = promptId;
    }
}

function savePrompt() {
    const name = document.getElementById('promptNameInput').value.trim();
    const content = document.getElementById('promptContentInput').value.trim();
    const editingId = document.getElementById('promptEditor').dataset.editingId;
    
    if (!name || !content) {
        showNotification('error', 'Chyba', 'Vypl≈àte n√°zev i obsah promptu');
        return;
    }
    
    const savedPrompts = JSON.parse(localStorage.getItem('aicode_prompts') || '[]');
    
    if (editingId) {
        const index = savedPrompts.findIndex(p => p.id === editingId);
        if (index !== -1) {
            savedPrompts[index] = { id: editingId, name, content };
        }
    } else {
        const id = generateId();
        savedPrompts.push({ id, name, content });
    }
    
    localStorage.setItem('aicode_prompts', JSON.stringify(savedPrompts));
    cancelPromptEdit();
    loadPrompts();
    showNotification('success', 'Prompt ulo≈æen', 'Prompt byl √∫spƒõ≈°nƒõ ulo≈æen');
}

function exportPrompt() {
    const name = document.getElementById('promptNameInput').value.trim();
    const content = document.getElementById('promptContentInput').value.trim();
    
    if (!name || !content) {
        showNotification('error', 'Chyba', 'Vypl≈àte n√°zev i obsah promptu');
        return;
    }
    
    const promptData = {
        name,
        content,
        created: new Date().toISOString(),
        version: '1.0'
    };
    
    downloadJSON(promptData, `${name.replace(/\s+/g, '_')}.json`);
}

function exportSinglePrompt(promptId) {
    const prompts = getAllPrompts();
    const prompt = prompts.find(p => p.id === promptId);
    
    if (prompt) {
        const promptData = {
            name: prompt.name,
            content: prompt.content,
            created: new Date().toISOString(),
            version: '1.0'
        };
        
        downloadJSON(promptData, `${prompt.name.replace(/\s+/g, '_')}.json`);
    }
}

function importPrompt(event) {
    const file = event.target.files[0];
    if (!file) return;
    
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const promptData = JSON.parse(e.target.result);
            
            if (!promptData.name || !promptData.content) {
                showNotification('error', 'Chyba', 'Neplatn√Ω form√°t souboru');
                return;
            }
            
            document.getElementById('promptNameInput').value = promptData.name;
            document.getElementById('promptContentInput').value = promptData.content;
            document.getElementById('promptEditor').style.display = 'block';
            document.getElementById('promptList').style.display = 'none';
            
            showNotification('success', 'Import √∫spƒõ≈°n√Ω', 'Prompt byl naƒçten do editoru');
        } catch (error) {
            showNotification('error', 'Chyba', 'Nepoda≈ôilo se naƒç√≠st soubor');
        }
    };
    reader.readAsText(file);
    
    event.target.value = '';
}

function cancelPromptEdit() {
    document.getElementById('promptEditor').style.display = 'none';
    document.getElementById('promptList').style.display = 'block';
    delete document.getElementById('promptEditor').dataset.editingId;
}

function removePrompt(promptId) {
    if (isDefaultPrompt(promptId)) {
        showNotification('error', 'Chyba', 'Nelze odstranit v√Ωchoz√≠ prompt');
        return;
    }
    
    const savedPrompts = JSON.parse(localStorage.getItem('aicode_prompts') || '[]');
    const filteredPrompts = savedPrompts.filter(p => p.id !== promptId);
    localStorage.setItem('aicode_prompts', JSON.stringify(filteredPrompts));
    
    loadPrompts();
    showNotification('success', 'Prompt odstranƒõn', 'Prompt byl √∫spƒõ≈°nƒõ odstranƒõn');
}

function getAllPrompts() {
    const savedPrompts = JSON.parse(localStorage.getItem('aicode_prompts') || '[]');
    const defaultPrompts = [
        {
            id: 'website',
            name: 'Webov√° str√°nka',
            content: 'Jsi expertn√≠ webov√Ω v√Ωvoj√°≈ô. Vytvo≈ô modern√≠, responzivn√≠ webovou str√°nku podle zad√°n√≠ u≈æivatele. Pou≈æ√≠vej nejnovƒõj≈°√≠ HTML5, CSS3 a JavaScript. K√≥d mus√≠ b√Ωt ƒçist√Ω, s√©mantick√Ω a p≈ô√≠stupn√Ω.'
        },
        {
            id: 'game',
            name: 'Hra',
            content: 'Jsi expertn√≠ hern√≠ v√Ωvoj√°≈ô. Vytvo≈ô interaktivn√≠ hru podle zad√°n√≠ u≈æivatele. Pou≈æ√≠vej HTML5 Canvas nebo CSS pro grafiku a JavaScript pro logiku. Hra mus√≠ b√Ωt z√°bavn√° a funkƒçn√≠.'
        },
        {
            id: 'app',
            name: 'Webov√° aplikace',
            content: 'Jsi expertn√≠ frontend v√Ωvoj√°≈ô. Vytvo≈ô funkƒçn√≠ webovou aplikaci podle zad√°n√≠ u≈æivatele. Pou≈æ√≠vej modern√≠ JavaScript, CSS Grid/Flexbox a zajisti dobrou u≈æivatelskou zku≈°enost.'
        }
    ];
    
    return [...defaultPrompts, ...savedPrompts];
}

function isDefaultPrompt(promptId) {
    const defaultPromptIds = ['website', 'game', 'app'];
    return defaultPromptIds.includes(promptId);
}

// ==========================================
// 7. GENEROV√ÅN√ç K√ìDU - OPTIMALIZOV√ÅNO
// ==========================================

async function generateCode() {
    const prompt = elements.aiPrompt?.value.trim();
    if (!prompt) {
        elements.aiPrompt?.focus();
        return;
    }
    
    if (!currentPrompt) {
        showNotification('error', 'Chyba', 'Nen√≠ vybr√°n ≈æ√°dn√Ω system prompt');
        return;
    }
    
    const messages = [
        { role: 'system', content: currentPrompt },
        { role: 'system', content: 'Generuj kompletn√≠ HTML dokument s vlo≈æen√Ωm CSS a JavaScriptem. Nepou≈æ√≠vej markdown bloky (```html ani ```).' },
        { role: 'user', content: prompt }
    ];
    
    await streamGeneration(messages, false);
}

async function continueGeneration() {
    if (conversation.length === 0) return;
    
    const messages = [...conversation, { 
        role: 'user', 
        content: 'Pokraƒçuj tam, kde jsi skonƒçil.' 
    }];
    
    await streamGeneration(messages, true);
}

async function streamGeneration(messages, isContinuation = false) {
    if (isGenerating) return;
    
    isGenerating = true;
    conversation = messages.map(m => ({ ...m }));
    
    // Optimalizovan√© UI zmƒõny
    elements.sendBtn.disabled = true;
    elements.continueBtn.style.display = 'none';
    document.querySelector('.preview-frame-wrapper').classList.add('generating');
    
    if (!autoUpdateEnabled) {
        autoUpdateEnabled = true;
        document.getElementById('toggleAutoUpdateBtn').classList.add('active');
    }
    
    if (!isContinuation) {
        // Reset pro nov√© generov√°n√≠
        htmlBuffer = '';
        cssBuffer = '';
        jsBuffer = '';
        thinkBuffer = '';
        

        thingModel.setValue('');
        
        // Skryt√≠ extra tab≈Ø
        document.querySelectorAll('.filename[data-model="style"], .filename[data-model="script"], .filename[data-model="thing"]')
            .forEach(tab => tab.style.display = 'none');
        
        // Aktivace index tabu
        switchEditorTab(document.querySelector('.filename[data-model="index"]'));
    }
    
    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${API_KEY}`
            },
            body: JSON.stringify({
                model: currentModel,
                messages: messages,
                stream: true,
                temperature: aiSettings.temperature,
                max_tokens: aiSettings.maxTokens,
                top_p: aiSettings.topP,
                frequency_penalty: aiSettings.frequencyPenalty
            })
        });
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let buffer = '';
        let inThinking = false;
        let currentFileType = 'html';
        
        while (true) {
            const { value, done } = await reader.read();
            if (done) break;
            
            buffer += decoder.decode(value, { stream: true });
            const lines = buffer.split('\n\n');
            buffer = lines.pop();
            
            for (const line of lines) {
                if (!line.startsWith('data: ')) continue;
                
                const data = line.slice(6).trim();
                if (data === '[DONE]') continue;
                
                try {
                    const parsed = JSON.parse(data);
                    const delta = parsed.choices?.[0]?.delta?.content;
                    if (!delta) continue;
                    
                    // Zpracov√°n√≠ obsahu
                    await processStreamContent(delta, inThinking, currentFileType);
                    
                } catch (error) {
                    console.warn('Chyba p≈ôi parsov√°n√≠ stream dat:', error);
                }
            }
        }
        
        showNotification('success', 'Generov√°n√≠ dokonƒçeno', 'K√≥d byl √∫spƒõ≈°nƒõ vygenerov√°n');
        
    } catch (error) {
        console.error('Chyba p≈ôi generov√°n√≠:', error);
        showNotification('error', 'Chyba generov√°n√≠', error.message);
    } finally {
        isGenerating = false;
        elements.sendBtn.disabled = false;
        document.querySelector('.preview-frame-wrapper').classList.remove('generating');
        updateCreditBalance();
    }
}

async function processStreamContent(chunk) {
    // 1) pryƒç markdown bloky
    chunk = chunk.replace(/```(html|css|javascript|js)?\n?/gi, '');

    // 2) vyhoƒè cokoliv v <think> ... </think>
    chunk = chunk.replace(/<think>[\s\S]*?<\/think>/gi, '');

    // 3) detekuj zaƒç√°tek HTML
    if (!insideHtmlDoc) {
        const start = chunk.search(/<!DOCTYPE\s+html>|<html[\s>]/i);
        if (start === -1) return;               // je≈°tƒõ nic pou≈æiteln√©ho
        chunk = chunk.slice(start);             // o≈ôe≈æeme proslov p≈ôed <!DOCTYPE
        insideHtmlDoc = true;
    }

    // 4) pokud u≈æ m√°me konec </html>, ignoruj v≈°e za n√≠m
    const end = chunk.search(/<\/html>/i);
    if (end !== -1) {
        chunk = chunk.slice(0, end + 7);        // vƒçetnƒõ </html>
        insideHtmlDoc = false;                  // p≈ô√≠padn√© dal≈°√≠ tokeny ignorujeme
    }

    // 5) ulo≈æ do bufferu a editoru
    htmlBuffer += chunk;
    indexModel.setValue(htmlBuffer);

    if (autoUpdateEnabled) throttledUpdatePreview();
}


// Throttled update preview
const throttledUpdatePreview = throttle(updatePreview, 500);

function showTab(tabName) {
    const tab = document.querySelector(`.filename[data-model="${tabName}"]`);
    if (tab) {
        tab.style.display = 'inline-block';
    }
}

// ==========================================
// 8. PREVIEW A EDITOR - OPTIMALIZOV√ÅNO
// ==========================================

function updatePreview() {
    if (!autoUpdateEnabled || !elements.renderFrame) return;
    elements.renderFrame.srcdoc = htmlBuffer;
}


function switchEditorTab(tab) {
    if (!tab) return;

    // p≈ôepnut√≠ aktivn√≠ z√°lo≈æky v UI
    document.querySelectorAll('.filename').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');

    // model ‚Äì m√°me u≈æ jen indexModel a (volitelnƒõ) thingModel
    const modelType = tab.dataset.model;
    const targetModel = modelType === 'thing' ? thingModel : indexModel;

    editor.setModel(targetModel);
}


function toggleAutoUpdate() {
    autoUpdateEnabled = !autoUpdateEnabled;
    const btn = document.getElementById('toggleAutoUpdateBtn');
    btn.classList.toggle('active', autoUpdateEnabled);
    
    if (autoUpdateEnabled) {
        updatePreview();
    }
}

function resetEditor() {
    htmlBuffer = getDefaultHTML();
    insideHtmlDoc = false;      // <‚Äì‚Äì p≈ôidat
    indexModel.setValue(htmlBuffer);
    elements.aiPrompt.value = '';
    conversation = [];
    updatePreview();
    showNotification('info','Editor resetov√°n','Soubor index.html byl vymaz√°n');
}


function openPreviewInNewWindow() {
    let fullHTML = htmlBuffer;
    
    if (cssBuffer) {
        const styleTag = `<style>${cssBuffer}</style>`;
        if (fullHTML.includes('</head>')) {
            fullHTML = fullHTML.replace('</head>', `${styleTag}\n</head>`);
        } else {
            fullHTML = `<style>${cssBuffer}</style>\n${fullHTML}`;
        }
    }
    
    if (jsBuffer) {
        const scriptTag = `<script>${jsBuffer}</script>`;
        if (fullHTML.includes('</body>')) {
            fullHTML = fullHTML.replace('</body>', `${scriptTag}\n</body>`);
        } else {
            fullHTML = `${fullHTML}\n<script>${jsBuffer}</script>`;
        }
    }
    
    const newWindow = window.open('', '_blank');
    newWindow.document.write(fullHTML);
    newWindow.document.close();
}

// ==========================================
// 9. STAHOV√ÅN√ç PROJEKTU - OPTIMALIZOV√ÅNO
// ==========================================

async function downloadProject() {
    console.log('‚úÇÔ∏è downloadProject byl spu≈°tƒõn');

    if (!window.JSZip) {
        showNotification('error', 'Chyba', 'JSZip knihovna nen√≠ naƒçtena');
        return;
    }

    const zip = new JSZip();


    // Optimalizovan√© README
    const readme = `# AICODE STUDIO Projekt

Tento projekt byl vygenerov√°n pomoc√≠ AICODE STUDIO.

## Soubory:
- index.html ‚Äì Hlavn√≠ HTML soubor
${cssBuffer.trim() ? '- style.css ‚Äì CSS styly\n' : ''}${jsBuffer.trim() ? '- script.js ‚Äì JavaScript k√≥d\n' : ''}

## Spu≈°tƒõn√≠:
Otev≈ôete index.html v prohl√≠≈æeƒçi.

Vytvo≈ôeno: ${new Date().toLocaleString('cs-CZ')}
`;
    zip.file('README.md', readme);

    try {
        const content = await zip.generateAsync({ type: 'blob' });
        const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
        const filename = `aicode-project-${timestamp}.zip`;

        // Optimalizovan√© stahov√°n√≠
        const link = document.createElement('a');
        link.href = URL.createObjectURL(content);
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(link.href);

        showNotification('success', 'Projekt sta≈æen', `Soubor ${filename} byl √∫spƒõ≈°nƒõ sta≈æen`);
    } catch (error) {
        console.error('Chyba p≈ôi vytv√°≈ôen√≠ ZIP:', error);
        showNotification('error', 'Chyba', 'Nepoda≈ôilo se vytvo≈ôit ZIP soubor');
    }
}

// ==========================================
// 10. NASTAVEN√ç - OPTIMALIZOV√ÅNO
// ==========================================

function loadSettings() {
    const savedSettings = localStorage.getItem('aicode_settings');
    if (savedSettings) {
        aiSettings = { ...aiSettings, ...JSON.parse(savedSettings) };
    }
    
    const savedApiKey = localStorage.getItem('openrouter_api_key');
    if (savedApiKey) {
        API_KEY = savedApiKey;
    }
    
    updateSettingsUI();
}

function updateSettingsUI() {
    const settingsElements = {
        temperatureSlider: document.getElementById('temperatureSlider'),
        temperatureValue: document.getElementById('temperatureValue'),
        maxTokensInput: document.getElementById('maxTokensInput'),
        topPSlider: document.getElementById('topPSlider'),
        topPValue: document.getElementById('topPValue'),
        frequencyPenaltySlider: document.getElementById('frequencyPenaltySlider'),
        frequencyPenaltyValue: document.getElementById('frequencyPenaltyValue'),
        apiKeyInput: document.getElementById('apiKeyInput')
    };
    
    // Optimalizovan√© batch update
    Object.entries(settingsElements).forEach(([key, element]) => {
        if (!element) return;
        
        if (key.includes('Slider')) {
            const setting = key.replace('Slider', '');
            element.value = aiSettings[setting];
        } else if (key.includes('Value')) {
            const setting = key.replace('Value', '');
            element.textContent = aiSettings[setting];
        } else if (key === 'maxTokensInput') {
            element.value = aiSettings.maxTokens;
        } else if (key === 'apiKeyInput') {
            element.value = API_KEY;
        }
    });
}

function saveSettings() {
    const temperature = parseFloat(document.getElementById('temperatureSlider').value);
    const maxTokens = parseInt(document.getElementById('maxTokensInput').value);
    const topP = parseFloat(document.getElementById('topPSlider').value);
    const frequencyPenalty = parseFloat(document.getElementById('frequencyPenaltySlider').value);
    const apiKey = document.getElementById('apiKeyInput').value.trim();
    
    // Optimalizovan√° validace
    if (maxTokens < 100 || maxTokens > 100000) {
        showNotification('error', 'Chyba', 'Maxim√°ln√≠ tokeny mus√≠ b√Ωt mezi 100 a 100000');
        return;
    }
    
    if (!apiKey) {
        showNotification('error', 'Chyba', 'API kl√≠ƒç je povinn√Ω');
        return;
    }
    
    // Batch update
    aiSettings = { temperature, maxTokens, topP, frequencyPenalty };
    API_KEY = apiKey;
    
    localStorage.setItem('aicode_settings', JSON.stringify(aiSettings));
    localStorage.setItem('openrouter_api_key', apiKey);
    
    closeModal('settingsModal');
    showNotification('success', 'Nastaven√≠ ulo≈æeno', 'V≈°echna nastaven√≠ byla √∫spƒõ≈°nƒõ ulo≈æena');
}

// ==========================================
// 11. MODALY - OPTIMALIZOV√ÅNO
// ==========================================

function openModal(modalType) {
    const modalMap = {
        'settings': 'settingsModal',
        'promptManager': 'promptManagerModal',
        'modelManager': 'modelManagerModal'
    };
    
    const modalId = modalMap[modalType];
    if (!modalId) return;
    
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.add('active');
        document.body.style.overflow = 'hidden';
        
        // Optimalizovan√© naƒç√≠t√°n√≠ dat podle typu modalu
        switch (modalType) {
            case 'settings':
                updateSettingsUI();
                break;
            case 'promptManager':
                loadPrompts();
                break;
            case 'modelManager':
                loadModels();
                break;
        }
    }
}

function closeModal(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
        modal.classList.remove('active');
        document.body.style.overflow = '';
    }
}

// ==========================================
// 12. NOTIFIKACE - OPTIMALIZOV√ÅNO
// ==========================================

function showNotification(type, title, message) {
    const notification = document.createElement('div');
    notification.className = `notification ${type} show`;
    
    const iconMap = {
        success: 'fas fa-check-circle',
        error: 'fas fa-exclamation-circle',
        info: 'fas fa-info-circle',
        warning: 'fas fa-exclamation-triangle'
    };
    
    notification.innerHTML = `
        <i class="${iconMap[type] || iconMap.info}"></i>
        <div class="notification-content">
            <h4>${title}</h4>
            <p>${message}</p>
        </div>
        <button class="notification-close" aria-label="Zav≈ô√≠t notifikaci">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    // Optimalizovan√© event handling
    notification.querySelector('.notification-close').addEventListener('click', () => {
        removeNotification(notification);
    });
    
    if (elements.notificationsContainer) {
        elements.notificationsContainer.appendChild(notification);
    }
    
    // Optimalizovan√© automatick√© odstranƒõn√≠
    setTimeout(() => removeNotification(notification), 5000);
}

function removeNotification(notification) {
    if (notification && notification.parentNode) {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }
}

// ==========================================
// 13. POMOCN√â FUNKCE - OPTIMALIZOV√ÅNO
// ==========================================

function generateId() {
    return Math.random().toString(36).substr(2, 9);
}

function downloadJSON(data, filename) {
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(link.href);
}

async function updateCreditBalance() {
    try {
        const response = await fetch('https://openrouter.ai/api/v1/credits', {
            headers: { 'Authorization': `Bearer ${API_KEY}` }
        });
        
        if (response.ok) {
            const data = await response.json();
            const remaining = data.data.total_credits - data.data.total_usage;
            if (elements.creditAmount) {
                elements.creditAmount.textContent = remaining.toFixed(2);
            }
        }
    } catch (error) {
        console.warn('Nepoda≈ôilo se naƒç√≠st z≈Østatek kreditu:', error);
    }
}

// ==========================================
// 14. SNAKE BORDER ANIMACE - OPTIMALIZOV√ÅNO
// ==========================================

function initializeSnakeBorder() {
    const wrapper = document.querySelector('.preview-frame-wrapper');
    if (!wrapper) return;
    
    const rects = wrapper.querySelectorAll('rect');
    if (rects.length < 2) return;
    
    function updateSnakeBorder() {
        const w = wrapper.clientWidth;
        const h = wrapper.clientHeight;
        const stroke = 2;
        
        rects.forEach(rect => {
            rect.setAttribute('x', stroke / 2);
            rect.setAttribute('y', stroke / 2);
            rect.setAttribute('width', w - stroke);
            rect.setAttribute('height', h - stroke);
        });
        
        const perimeter = 2 * (w + h) - 4 * stroke;
        wrapper.style.setProperty('--dash-length', `${perimeter}px`);
        
        const segment = perimeter * 0.6;
        wrapper.style.setProperty('--snake-segment', `${segment}px`);
    }
    
    // Throttled update
    const throttledUpdate = throttle(updateSnakeBorder, 100);
    
    throttledUpdate();
    
    if (window.ResizeObserver) {
        new ResizeObserver(throttledUpdate).observe(wrapper);
    }
}

// ==========================================
// 15. GOOGLE ADS - OPTIMALIZOV√ÅNO
// ==========================================

function initializeAds() {
    if (window.adsbygoogle) {
        try {
            (adsbygoogle = window.adsbygoogle || []).push({});
        } catch (error) {
            console.warn('Chyba p≈ôi naƒç√≠t√°n√≠ reklam:', error);
        }
    }
    
    // Optimalizovan√Ω fallback
    setTimeout(() => {
        const adsContent = document.getElementById('adsContent');
        const adsBanner = adsContent?.querySelector('.adsbygoogle');
        
        if (adsBanner && !adsBanner.innerHTML.trim()) {
            adsBanner.style.display = 'none';
            const fallbackAd = adsContent.querySelector('.fallback-ad');
            if (fallbackAd) {
                fallbackAd.style.display = 'block';
            }
        }
    }, 3000);
}

function toggleAds() {
    const adsContent = document.getElementById('adsContent');
    const minimizeBtn = document.getElementById('adsMinimizeBtn');
    
    if (adsContent && minimizeBtn) {
        const isMinimized = adsContent.classList.contains('minimized');
        
        adsContent.classList.toggle('minimized');
        minimizeBtn.innerHTML = isMinimized 
            ? '<i class="fas fa-minus"></i>' 
            : '<i class="fas fa-plus"></i>';
    }
}

// ==========================================
// 16. GLOB√ÅLN√ç ERROR HANDLING - OPTIMALIZOV√ÅNO
// ==========================================

window.addEventListener('error', (event) => {
    console.error('Glob√°ln√≠ chyba:', event.error);
    showNotification('error', 'Chyba aplikace', 'Do≈°lo k neoƒçek√°van√© chybƒõ');
});

window.addEventListener('unhandledrejection', (event) => {
    console.error('Neo≈°et≈ôen√Ω Promise reject:', event.reason);
    showNotification('error', 'Chyba aplikace', 'Do≈°lo k chybƒõ p≈ôi asynchronn√≠ operaci');
});

// ==========================================
// 17. EXPORT FUNKC√ç PRO GLOB√ÅLN√ç POU≈ΩIT√ç
// ==========================================

window.selectModel = selectModel;
window.removeModel = removeModel;
window.editPrompt = editPrompt;
window.exportSinglePrompt = exportSinglePrompt;
window.removePrompt = removePrompt; style.css: 









:root {
    /* Core colors - Updated to requested palette */
    --bg-primary: #dcdfe4; /* Hlavn√≠ barva */
    --bg-secondary: #ffffff; /* Svƒõtlej≈°√≠ pozad√≠ pro ƒç√°sti UI */
    --bg-tertiary: #f0f2f5; /* Je≈°tƒõ svƒõtlej≈°√≠ pozad√≠ */
    --text-primary: #111111; /* Hlavn√≠ textov√° barva */
    --text-secondary: #555555; /* Sekund√°rn√≠ textov√° barva */
    --text-muted: #888888; /* Ztlumen√° textov√° barva */
    
    /* Accent colors - Updated to requested palette */
    --accent-orange: #d47020; /* Hlavn√≠ akcentn√≠ barva */
    --accent-dark: #111111; /* Tmav√Ω akcent */
    
    /* Original accent colors (kept for gradients/specific elements if needed) */
    --accent-teal: #00ffcc;
    --accent-purple: #9d4edd;
    --accent-pink: #ff36ab;
    --accent-blue: #3a86ff;
    --accent-green: #06d6a0;
    
    /* Glass effects (adjusted for lighter background) */
    --glass-bg: rgba(255, 255, 255, 0.7); /* Svƒõtlej≈°√≠ sklo */
    --glass-border: rgba(0, 0, 0, 0.08); /* Tmav≈°√≠ ohraniƒçen√≠ skla */
    --glass-highlight: rgba(0, 0, 0, 0.05); /* Tmav≈°√≠ zv√Ωraznƒõn√≠ skla */
    --glass-shadow: rgba(0, 0, 0, 0.1); /* Jemnƒõj≈°√≠ st√≠n */
    
    /* Gradients (can be adjusted, keeping originals for logo) */
    --gradient-primary: linear-gradient(135deg, var(--accent-teal), var(--accent-purple));
    --gradient-secondary: linear-gradient(135deg, var(--accent-purple), var(--accent-pink));
    --gradient-tertiary: linear-gradient(135deg, var(--accent-blue), var(--accent-teal));
    --gradient-orange-dark: linear-gradient(135deg, var(--accent-orange), var(--accent-dark)); /* Nov√Ω gradient */
    
    /* Shadows */
    --shadow-sm: 0 2px 8px var(--glass-shadow);
    --shadow-md: 0 4px 16px var(--glass-shadow);
    --shadow-lg: 0 8px 32px var(--glass-shadow);
    
    /* Dimensions */
    --sidebar-width: 60px;
    --top-nav-height: 60px;
    --ads-panel-width: 300px;

    /* Fonts */
    --font-primary: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    --font-mono: 'Fira Code', monospace;
    
    /* Transitions */
    --transition-fast: 150ms ease;
    --transition-normal: 250ms ease;
    --transition-slow: 350ms ease;

    /* Border Radius */
    --border-radius-sm: 4px;
    --border-radius-md: 8px;
    --border-radius-lg: 12px;
}

/* Base styles */
*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html {
    height: 100%;
    width: 100%;
    overflow: hidden;
}

body {
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    font-family: var(--font-primary);
    font-size: 13px;
    line-height: 1.5;
    color: var(--text-primary);
    background: var(--bg-primary);
    /* Subtle background pattern */
    background-image: 
        radial-gradient(circle at 10% 20%, rgba(212, 112, 32, 0.05) 0%, transparent 30%),
        radial-gradient(circle at 90% 80%, rgba(17, 17, 17, 0.05) 0%, transparent 30%);
    position: fixed;
    top: 0;
    left: 0;
}

button, input, textarea {
    font-family: inherit;
    font-size: inherit;
    color: inherit;
    border: none;
    background: none;
    outline: none;
}

button {
    cursor: pointer;
}

button:disabled {
    cursor: not-allowed;
    opacity: 0.6;
}

/* Skip link */
.skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: var(--accent-orange);
    color: white;
    padding: 8px 16px;
    z-index: 1000;
    transition: top 0.3s;
}

.skip-link:focus {
    top: 0;
}

/* App layout */
.app-container {
    display: grid;
    grid-template-areas:
        "sidebar top-nav top-nav"
        "sidebar main main";
    grid-template-columns: var(--sidebar-width) 1fr;
    grid-template-rows: var(--top-nav-height) calc(100vh - var(--top-nav-height));
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    position: fixed;
    top: 0;
    left: 0;
}

/* Top navigation */
.top-nav {
    grid-area: top-nav;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 24px;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
    backdrop-filter: blur(8px); /* Jemnƒõj≈°√≠ blur */
    -webkit-backdrop-filter: blur(8px);
    border-bottom: 1px solid var(--glass-border);
    z-index: 10;
    height: var(--top-nav-height);
    min-height: var(--top-nav-height);
    max-height: var(--top-nav-height);
}

.logo {
    display: flex;
    align-items: center;
    gap: 12px;
}

.logo-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: var(--glass-highlight);
    box-shadow: var(--shadow-sm);
}

.logo h1 {
    font-size: 1.25rem;
    font-weight: 600;
    background: var(--gradient-primary); /* Keeping original gradient for logo */
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
}

/* Topbar selectors */
.topbar-selectors {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-left: auto;
    margin-right: auto;
}

.topbar-selectors > * {
    flex-shrink: 0;
}

/* Model selector */
.model-selector {
    position: relative;
    z-index: 101;
}

.model-display {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: var(--bg-tertiary); /* Svƒõtlej≈°√≠ pozad√≠ */
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-md);
    transition: var(--transition-normal);
    min-width: 200px;
    cursor: pointer;
    color: var(--text-primary);
}

.model-display:hover {
    border-color: var(--accent-orange);
}

.model-status {
    display: flex;
    align-items: center;
}

.status-indicator {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--text-muted);
}

.status-indicator.active {
    background: var(--accent-green); /* Keeping green for active status */
    box-shadow: 0 0 8px rgba(6, 214, 160, 0.5);
    animation: pulse 2s infinite;
}

.model-name {
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 120px;
    color: var(--text-primary);
}

.model-dropdown-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    transition: var(--transition-fast);
}

.model-dropdown-btn:hover {
    color: var(--accent-orange);
}

.model-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    width: 280px;
    max-height: 400px;
    overflow-y: auto;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-md);
    box-shadow: var(--shadow-md);
    z-index: 100;
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
    transition: var(--transition-normal);
    visibility: hidden;
}

.model-selector.open .model-dropdown {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    visibility: visible;
}

.model-option {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    cursor: pointer;
    transition: var(--transition-fast);
    color: var(--text-primary);
}

.model-option:hover {
    background: var(--bg-tertiary);
}

.model-option.selected {
    background: rgba(212, 112, 32, 0.1); /* Jemn√Ω akcent */
    color: var(--accent-orange);
}

.model-option-name {
    font-size: 0.875rem;
    font-weight: 500;
}

.model-option-tag {
    font-size: 0.75rem;
    padding: 2px 6px;
    border-radius: var(--border-radius-sm);
    background: var(--accent-dark); /* Tmav√Ω tag */
    color: white;
}

/* Prompt selector */
.prompt-selector {
    position: relative;
    z-index: 101;
}

.prompt-display {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    background: var(--bg-tertiary); /* Svƒõtlej≈°√≠ pozad√≠ */
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-md);
    transition: var(--transition-normal);
    min-width: 200px;
    cursor: pointer;
    color: var(--text-primary);
}

.prompt-display:hover {
    border-color: var(--accent-orange);
}

.prompt-name {
    font-size: 0.875rem;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 120px;
    color: var(--text-primary);
}

.prompt-dropdown-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-secondary);
    transition: var(--transition-fast);
}

.prompt-dropdown-btn:hover {
    color: var(--accent-orange);
}

.prompt-dropdown {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    width: 280px;
    max-height: 400px;
    overflow-y: auto;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-md);
    box-shadow: var(--shadow-md);
    z-index: 100;
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
    transition: var(--transition-normal);
    visibility: hidden;
}

.prompt-selector.open .prompt-dropdown {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
    visibility: visible;
}

.prompt-option {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    cursor: pointer;
    transition: var(--transition-fast);
    color: var(--text-primary);
}

.prompt-option:hover {
    background: var(--bg-tertiary);
}

.prompt-option.selected {
    background: rgba(212, 112, 32, 0.1); /* Jemn√Ω akcent */
    color: var(--accent-orange);
}

.prompt-option-name {
    font-size: 0.875rem;
    font-weight: 500;
}

/* User controls */
.user-controls {
    display: flex;
    align-items: center;
    gap: 16px;
}

.settings-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: var(--bg-tertiary); /* Svƒõtlej≈°√≠ pozad√≠ */
    color: var(--text-primary);
    transition: var(--transition-fast);
    border: 1px solid transparent; /* P≈ôid√°n border pro hover efekt */
}

.settings-btn:hover {
    background: var(--bg-secondary);
    color: var(--accent-orange);
    border-color: var(--accent-orange);
}

.user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    overflow: hidden;
    border: 2px solid var(--glass-border);
    transition: var(--transition-fast);
}

.user-avatar:hover {
    border-color: var(--accent-orange);
}

.user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

/* Sidebar */
.sidebar {
    grid-area: sidebar;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
    backdrop-filter: blur(8px); /* Jemnƒõj≈°√≠ blur */
    -webkit-backdrop-filter: blur(8px);
    padding: 16px 0;
    z-index: 10;
    height: 100vh;
    min-height: 100vh;
    max-height: 100vh;
    overflow: hidden;
    border-right: 1px solid var(--glass-border);
}

.sidebar-icons {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.sidebar-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: var(--border-radius-md);
    color: var(--text-secondary);
    transition: var(--transition-fast);
}

.sidebar-icon:hover {
  color: white;
  background-color: var(--accent-orange);
  border-radius: 50%; /* Kulat√Ω hover */
}

.sidebar-icon.active {
  color: white;
  background-color: var(--accent-orange);
  border-radius: 50%; /* Kulat√Ω aktivn√≠ stav */
}

.sidebar-bottom {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.sidebar-balance {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: auto;
    padding: 16px 0;
}

.credit-circle {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--gradient-orange-dark); /* Nov√Ω gradient */
    padding: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow:
        0 4px 12px rgba(212, 112, 32, 0.3),
        0 0 20px rgba(17, 17, 17, 0.5);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.credit-circle:hover {
    transform: scale(1.1);
    box-shadow:
        0 6px 16px rgba(212, 112, 32, 0.4),
        0 0 24px rgba(17, 17, 17, 0.7);
}

.credit-inner {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

.credit-amount {
    font-size: 0.8rem;
    font-weight: 700;
    color: var(--accent-orange); /* Oran≈æov√° barva */
    text-shadow: 0 0 4px rgba(212, 112, 32, 0.5);
}

.credit-unit {
    font-size: 0.6rem;
    color: var(--text-muted);
    margin-top: -2px;
    letter-spacing: 0.5px;
    text-transform: uppercase;
}

.credit-footer {
    margin-top: 8px;
}

.credit-footer a {
    font-size: 0.50rem;
    color: var(--text-muted);
    text-decoration: none;
    transition: color 0.2s ease, text-shadow 0.2s ease;
}

.credit-footer a:hover {
    color: var(--accent-orange);
    text-shadow: 0 0 4px var(--accent-orange);
}

/* Drag bar */
.dragbar {
    position: absolute;
    top: var(--top-nav-height);
    left: var(--sidebar-width);
    width: 4px;
    height: calc(100vh - var(--top-nav-height));
    background: transparent;
    cursor: ew-resize;
    z-index: 20;
}

.dragbar:hover, body.dragging .dragbar {
    background: var(--accent-orange); /* Oran≈æov√Ω drag bar */
}

/* Main content */
.main-content {
    grid-area: main;
    display: flex;
    height: calc(100vh - var(--top-nav-height));
    min-height: calc(100vh - var(--top-nav-height));
    max-height: calc(100vh - var(--top-nav-height));
    gap: 16px; /* P≈ôid√°n gap pro oddƒõlen√≠ panel≈Ø */
    padding: 16px;
    overflow: hidden;
    background-color: var(--bg-primary); /* Hlavn√≠ pozad√≠ */
}

/* Editor container */
.editor-container {
    display: flex;
    height: 100%;
    min-height: 0;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
    border-radius: var(--border-radius-lg); /* Zaoblen√© rohy */
    overflow: hidden;
    flex: 1 1 auto;
    min-width: 300px;
    box-shadow: var(--shadow-md); /* Jemn√Ω st√≠n */
}

.prompt-left {
    flex: 0 0 300px; /* M√≠rnƒõ ≈°ir≈°√≠ prompt panel */
    display: flex;
    flex-direction: column;
    gap: 16px; /* Vƒõt≈°√≠ mezera */
    padding: 20px; /* Vƒõt≈°√≠ padding */
    background: var(--bg-tertiary); /* Je≈°tƒõ svƒõtlej≈°√≠ pozad√≠ */
    height: 100%;
    min-height: 0;
    overflow: hidden;
    border-right: 1px solid var(--glass-border); /* Oddƒõlovac√≠ linka */
}

.prompt-input-container {
    flex: 1;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ pro input */
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-md); /* Zaoblen√© rohy */
    overflow: hidden;
    min-height: 0;
    transition: border-color var(--transition-fast);
}

.prompt-input-container:focus-within {
    border-color: var(--accent-orange); /* Oran≈æov√Ω focus */
}

.prompt-input {
    width: 100%;
    height: 100%;
    padding: 12px;
    resize: none;
    background: transparent;
    color: var(--text-primary);
    overflow-y: auto;
}

.prompt-input::placeholder {
    color: var(--text-muted);
}

.prompt-buttons {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 12px;
    flex-shrink: 0;
}

.prompt-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    font-weight: 500;
    border-radius: var(--border-radius-md);
    transition: var(--transition-fast);
    border: 1px solid transparent; /* P≈ôid√°n border pro hover */
}

.reset-btn {
    color: var(--text-primary);
    background: var(--bg-secondary);
    border-color: var(--glass-border);
}

.reset-btn:hover {
    background: var(--bg-tertiary);
    border-color: var(--accent-orange);
    color: var(--accent-orange);
}

.continue-btn {
    color: white;
    background: var(--gradient-tertiary); /* Ponech√°n gradient */
    box-shadow: 0 2px 8px rgba(58, 134, 255, 0.3);
}

.continue-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(58, 134, 255, 0.4);
}

.send-btn {
    color: white;
    background: var(--accent-orange); /* Oran≈æov√© tlaƒç√≠tko */
    box-shadow: 0 2px 8px rgba(212, 112, 32, 0.3);
}

.send-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(212, 112, 32, 0.4);
}

/* Code panel */
.code-panel {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-width: 0;
    min-height: 0;
    height: 100%;
    overflow: hidden;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
}

.editor-tabs {
    display: flex;
    align-items: center;
    gap: 2px;
    padding: 8px 16px 0;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
    border-bottom: 1px solid var(--glass-border);
    flex: 0 0 auto;
}

.filename {
    padding: 8px 16px;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-secondary);
    background: transparent;
    border-radius: var(--border-radius-sm) var(--border-radius-sm) 0 0;
    transition: var(--transition-fast);
    cursor: pointer;
}

.filename:hover {
    color: var(--text-primary);
}

.filename.active {
    color: var(--text-primary);
    background: var(--bg-tertiary); /* Je≈°tƒõ svƒõtlej≈°√≠ pozad√≠ */
    border-top: 2px solid var(--accent-orange); /* Oran≈æov√Ω aktivn√≠ tab */
}

.code-editor {
    flex: 1 1 0;
    min-width: 0;
    min-height: 0;
    overflow: hidden;
}

#editor {
    width: 100%;
    height: 100%;
    min-height: 0;
    min-width: 0;
}

.editor-status-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 4px 16px;
    background: var(--accent-dark); /* Tmav√Ω status bar */
    border-top: 1px solid var(--glass-border);
    font-size: 0.75rem;
    color: var(--text-muted);
    flex: 0 0 auto;
}

.editor-status-left, .editor-status-right {
    display: flex;
    align-items: center;
    gap: 16px;
}

.editor-status-item {
    display: flex;
    align-items: center;
    gap: 4px;
}

.editor-status-btn {
    display: flex;
    align-items: center;
    gap: 6px;
    padding: 4px 8px;
    border-radius: var(--border-radius-sm);
    color: var(--text-secondary);
    transition: var(--transition-fast);
}

.editor-status-btn:hover {
    background: rgba(255, 255, 255, 0.1); /* Svƒõtlej≈°√≠ hover na tmav√©m pozad√≠ */
    color: white;
}

.editor-status-btn.active {
    color: var(--accent-orange); /* Oran≈æov√Ω aktivn√≠ status */
}

/* Resize bar */
.resize-bar {
  width: 12px;
  background-color: transparent; /* Transparentn√≠, viditeln√Ω jen na hover */
  cursor: ew-resize;
  transition: background-color var(--transition-fast), width var(--transition-fast);
  flex-shrink: 0; /* Zabr√°n√≠ zmen≈°en√≠ */
}

.resize-bar:hover,
.resizing .resize-bar {
  background-color: var(--accent-orange); /* Oran≈æov√Ω p≈ôi hover/resizing */
  width: 12px; /* ≈†√≠≈ôka z≈Øst√°v√° stejn√°, jen se zmƒõn√≠ barva */
}


/* Preview container */
.preview-container {
    display: flex;
    flex-direction: column;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
    border-radius: var(--border-radius-lg); /* Zaoblen√© rohy */
    overflow: hidden;
    flex: 1 1 auto;
    min-width: 300px;
    height: 100%;
    min-height: 0;
    box-shadow: var(--shadow-md); /* Jemn√Ω st√≠n */
}

.preview-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    background: var(--bg-tertiary); /* Je≈°tƒõ svƒõtlej≈°√≠ pozad√≠ */
    border-bottom: 1px solid var(--glass-border);
    flex-shrink: 0;
}

.preview-header h3 {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-primary);
}

.preview-controls {
    display: flex;
    align-items: center;
    gap: 8px;
}

.preview-control-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: var(--border-radius-sm);
    color: var(--text-secondary);
    transition: var(--transition-fast);
}

.preview-control-btn:hover {
    background: var(--bg-secondary);
    color: var(--accent-orange);
}

.preview-frame-wrapper {
    position: relative;
    flex: 1;
    background: var(--bg-primary); /* Hlavn√≠ pozad√≠ pro iframe */
    overflow: hidden;
    min-height: 0;
    --snake-segment: 50px;
    --snake-speed: 2s;
    --snake-blur: 1px; /* Jemnƒõj≈°√≠ blur */
    --snake-color-1: rgba(212, 112, 32, 0.9); /* Oran≈æov√° had√≠ barva 1 */
    --snake-glow-1: 6px; /* Jemnƒõj≈°√≠ z√°≈ôe */
    --snake-color-2: rgba(17, 17, 17, 0.9); /* Tmav√° had√≠ barva 2 */
    --snake-glow-2: 6px; /* Jemnƒõj≈°√≠ z√°≈ôe */
}

.preview-frame {
    width: 100%;
    height: 100%;
    border: none;
    background: transparent;
}

.preview-loading {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(220, 223, 228, 0.8); /* Svƒõtlej≈°√≠ loading overlay */
    z-index: 5;
    opacity: 0;
    pointer-events: none;
    transition: var(--transition-normal);
}

.preview-loading.active {
    opacity: 1;
    pointer-events: auto;
}

.preview-loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(212, 112, 32, 0.3); /* Oran≈æov√Ω spinner */
    border-top-color: var(--accent-orange); /* Oran≈æov√Ω spinner */
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

/* Snake border animation */
.snake-border-svg {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: visible;
    display: none;
}

.preview-frame-wrapper.generating .snake-border-svg {
    display: block;
}

.preview-frame-wrapper.generating .snake-border-svg rect {
    fill: none;
    stroke-width: 2;
    stroke-linecap: round;
    stroke-dasharray: var(--snake-segment) calc(var(--dash-length) - var(--snake-segment));
    stroke-dashoffset: 0;
    filter: blur(var(--snake-blur));
    animation: snake-move var(--snake-speed) linear infinite;
}

.preview-frame-wrapper.generating .snake-border-svg rect:nth-child(1) {
    stroke: var(--snake-color-1);
    filter:
        drop-shadow(0 0 var(--snake-glow-1) var(--snake-color-1))
        blur(var(--snake-blur));
    animation-direction: normal;
}

.preview-frame-wrapper.generating .snake-border-svg rect:nth-child(2) {
    stroke: var(--snake-color-2);
    filter:
        drop-shadow(0 0 var(--snake-glow-2) var(--snake-color-2))
        blur(var(--snake-blur));
    animation-direction: reverse;
}

/* Ads panel */
.ads-panel {
    width: var(--ads-panel-width);
    min-width: 250px;
    max-width: 350px;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-lg);
    overflow: hidden;
    margin-left: 16px;
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 0;
    flex-shrink: 0;
    box-shadow: var(--shadow-md); /* Jemn√Ω st√≠n */
}

.ads-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    background: var(--bg-tertiary); /* Je≈°tƒõ svƒõtlej≈°√≠ pozad√≠ */
    border-bottom: 1px solid var(--glass-border);
    font-size: 0.75rem;
    color: var(--text-primary);
    flex-shrink: 0;
}

.ads-minimize {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 20px;
    height: 20px;
    border-radius: var(--border-radius-sm);
    color: var(--text-secondary);
    transition: var(--transition-fast);
}

.ads-minimize:hover {
    background: var(--bg-secondary);
    color: var(--accent-orange);
}

.ads-content {
    flex: 1;
    padding: 16px;
    display: flex;
    flex-direction: column;
    gap: 16px;
    transition: var(--transition-normal);
    overflow-y: auto;
    min-height: 0;
    background-color: var(--bg-primary); /* Hlavn√≠ pozad√≠ */
}

.ads-content.minimized {
    display: none;
}

.ads-banner {
    min-height: 250px;
    background: var(--bg-tertiary); /* Svƒõtlej≈°√≠ pozad√≠ */
    border-radius: var(--border-radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    border: 1px dashed var(--glass-border); /* Jemn√© ohraniƒçen√≠ */
    color: var(--text-muted);
    font-size: 0.9rem;
}

.fallback-ad {
    background: var(--gradient-orange-dark); /* Nov√Ω gradient */
    border-radius: var(--border-radius-md);
    padding: 20px;
    text-align: center;
    color: white;
    box-shadow: var(--shadow-sm);
}

.fallback-ad-content h4 {
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.fallback-ad-content p {
    font-size: 0.875rem;
    opacity: 0.9;
    margin-bottom: 12px;
}

.fallback-ad-link {
    display: inline-block;
    padding: 8px 16px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: var(--border-radius-sm);
    color: white;
    text-decoration: none;
    font-weight: 500;
    transition: var(--transition-fast);
}

.fallback-ad-link:hover {
    background: rgba(255, 255, 255, 0.3);
}

/* Modals */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.6); /* Jemnƒõj≈°√≠ overlay */
    backdrop-filter: blur(6px); /* Jemnƒõj≈°√≠ blur */
    -webkit-backdrop-filter: blur(6px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: var(--transition-normal);
}

.modal.active {
    opacity: 1;
    pointer-events: auto;
}

.modal-content {
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-lg);
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    transform: scale(0.95); /* Jemnƒõj≈°√≠ animace */
    transition: var(--transition-normal);
}

.modal.active .modal-content {
    transform: scale(1);
}

.modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px 24px;
    border-bottom: 1px solid var(--glass-border);
    flex-shrink: 0;
    background: var(--bg-tertiary); /* Je≈°tƒõ svƒõtlej≈°√≠ pozad√≠ */
}

.modal-header h2 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary);
}

.modal-close {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    color: var(--text-secondary);
    transition: var(--transition-fast);
}

.modal-close:hover {
    background: var(--bg-secondary);
    color: var(--accent-orange);
}

.modal-body {
    flex: 1;
    padding: 24px;
    overflow-y: auto;
    min-height: 0;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
}

.modal-footer {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 12px;
    padding: 20px 24px;
    border-top: 1px solid var(--glass-border);
    flex-shrink: 0;
    background: var(--bg-tertiary); /* Je≈°tƒõ svƒõtlej≈°√≠ pozad√≠ */
}

/* Form elements */
.btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    font-weight: 500;
    border-radius: var(--border-radius-md);
    transition: var(--transition-fast);
    cursor: pointer;
    border: 1px solid transparent;
}

.btn-primary {
    color: white;
    background: var(--accent-orange); /* Oran≈æov√© prim√°rn√≠ tlaƒç√≠tko */
    box-shadow: 0 2px 8px rgba(212, 112, 32, 0.3);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(212, 112, 32, 0.4);
    background: #e07a2a; /* M√≠rnƒõ tmav≈°√≠ oran≈æov√° */
}

.btn-secondary {
    color: var(--text-primary);
    background: var(--bg-tertiary); /* Svƒõtlej≈°√≠ sekund√°rn√≠ tlaƒç√≠tko */
    border-color: var(--glass-border);
}

.btn-secondary:hover {
    background: var(--bg-secondary);
    border-color: var(--accent-orange);
    color: var(--accent-orange);
}

.text-input, .number-input {
    width: 100%;
    padding: 10px 12px;
    background: var(--bg-primary); /* Hlavn√≠ pozad√≠ pro input */
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-md);
    color: var(--text-primary);
    transition: var(--transition-fast);
}

.text-input:focus, .number-input:focus {
    border-color: var(--accent-orange); /* Oran≈æov√Ω focus */
    box-shadow: 0 0 0 2px rgba(212, 112, 32, 0.2);
}

.slider {
    width: 100%;
    height: 6px;
    background: var(--bg-tertiary); /* Svƒõtlej≈°√≠ pozad√≠ slideru */
    border-radius: 3px;
    outline: none;
    -webkit-appearance: none;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 18px;
    height: 18px;
    background: var(--accent-orange); /* Oran≈æov√Ω thumb */
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.slider::-moz-range-thumb {
    width: 18px;
    height: 18px;
    background: var(--accent-orange); /* Oran≈æov√Ω thumb */
    border-radius: 50%;
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

/* Settings sections */
.settings-section {
    margin-bottom: 24px;
    padding-bottom: 24px;
    border-bottom: 1px solid var(--glass-border);
}
.settings-section:last-child {
    border-bottom: none;
    padding-bottom: 0;
}

.settings-section h3 {
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 16px;
}

.setting-group {
    margin-bottom: 16px;
}

.setting-group label {
    display: block;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: 8px;
}

/* Prompt manager */
.prompt-manager-toolbar {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    flex-wrap: wrap; /* Pro lep≈°√≠ responzivitu */
}

.prompt-list {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-md);
    background: var(--bg-tertiary); /* Svƒõtlej≈°√≠ pozad√≠ */
}

.prompt-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    border-bottom: 1px solid var(--glass-border);
    transition: var(--transition-fast);
}

.prompt-item:last-child {
    border-bottom: none;
}

.prompt-item:hover {
    background: var(--bg-secondary);
}

.prompt-item-name {
    font-weight: 500;
    color: var(--text-primary);
    flex-grow: 1; /* Umo≈æn√≠ n√°zvu zabrat m√≠sto */
    margin-right: 12px; /* Mezera p≈ôed akcemi */
}

.prompt-item-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0; /* Zabr√°n√≠ zmen≈°en√≠ */
}

.prompt-item-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: var(--border-radius-sm);
    color: var(--text-secondary);
    transition: var(--transition-fast);
}

.prompt-item-btn:hover {
    background: var(--bg-secondary);
    color: var(--accent-orange);
}

.prompt-editor {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--glass-border);
}

.prompt-editor-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 12px;
    flex-wrap: wrap; /* Pro lep≈°√≠ responzivitu */
}

.prompt-editor-header .text-input {
    flex-grow: 1; /* Umo≈æn√≠ inputu zabrat m√≠sto */
    min-width: 150px; /* Minim√°ln√≠ ≈°√≠≈ôka inputu */
}

.prompt-editor-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: auto;
    flex-shrink: 0;
}

.prompt-textarea {
    width: 100%;
    height: 300px;
    padding: 12px;
    background: var(--bg-primary); /* Hlavn√≠ pozad√≠ pro textarea */
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-md);
    color: var(--text-primary);
    font-family: var(--font-mono);
    font-size: 0.875rem;
    resize: vertical;
    transition: border-color var(--transition-fast), box-shadow var(--transition-fast);
}

.prompt-textarea:focus {
    border-color: var(--accent-orange); /* Oran≈æov√Ω focus */
    box-shadow: 0 0 0 2px rgba(212, 112, 32, 0.2);
}

/* Model manager */
.model-manager-toolbar {
    margin-bottom: 20px;
}

.add-model-form {
    display: flex;
    align-items: center;
    gap: 12px;
    flex-wrap: wrap; /* Pro lep≈°√≠ responzivitu */
}

.add-model-form .text-input {
    flex: 1;
    min-width: 150px; /* Minim√°ln√≠ ≈°√≠≈ôka inputu */
}

.model-list {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-md);
    background: var(--bg-tertiary); /* Svƒõtlej≈°√≠ pozad√≠ */
}

.model-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 16px;
    border-bottom: 1px solid var(--glass-border);
    transition: var(--transition-fast);
}

.model-item:last-child {
    border-bottom: none;
}

.model-item:hover {
    background: var(--bg-secondary);
}

.model-item-info {
    flex: 1;
    margin-right: 12px; /* Mezera p≈ôed akcemi */
}

.model-item-name {
    font-weight: 500;
    color: var(--text-primary);
    margin-bottom: 2px;
}

.model-item-provider {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.model-item-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-shrink: 0;
}

.model-item-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 28px;
    height: 28px;
    border-radius: var(--border-radius-sm);
    color: var(--text-secondary);
    transition: var(--transition-fast);
}

.model-item-btn:hover {
    background: var(--bg-secondary);
    color: var(--accent-orange);
}

.model-item-btn.delete:hover {
    color: var(--accent-pink); /* R≈Ø≈æov√° pro smaz√°n√≠ */
}

/* Notifications */
.notifications-container {
    position: fixed;
    top: 16px;
    right: 16px;
    width: 320px;
    max-width: calc(100vw - 32px);
    display: flex;
    flex-direction: column;
    gap: 8px;
    z-index: 1001;
}

.notification {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
    background: var(--bg-secondary); /* Svƒõtlej≈°√≠ pozad√≠ */
    border: 1px solid var(--glass-border);
    border-radius: var(--border-radius-md);
    box-shadow: var(--shadow-md);
    transform: translateX(100%);
    transition: var(--transition-normal);
    color: var(--text-primary);
}

.notification.show {
    transform: translateX(0);
}

.notification.success {
    border-left: 3px solid var(--accent-green);
}

.notification.error {
    border-left: 3px solid var(--accent-pink);
}

.notification.info {
    border-left: 3px solid var(--accent-blue);
}

.notification.success i {
    color: var(--accent-green);
}

.notification.error i {
    color: var(--accent-pink);
}

.notification.info i {
    color: var(--accent-blue);
}

.notification-content {
    flex: 1;
}

.notification-content h4 {
    font-size: 0.875rem;
    font-weight: 600;
    margin-bottom: 4px;
}

.notification-content p {
    font-size: 0.8125rem;
    color: var(--text-secondary);
}

.notification-close {
    color: var(--text-muted);
    transition: var(--transition-fast);
}

.notification-close:hover {
    color: var(--text-primary);
}

/* Animations */
@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(6, 214, 160, 0.4);
    }
    70% {
        box-shadow: 0 0 0 6px rgba(6, 214, 160, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(6, 214, 160, 0);
    }
}

@keyframes spin {
    to {
        transform: rotate(360deg);
    }
}

@keyframes snake-move {
    to { 
        stroke-dashoffset: var(--dash-length); 
    }
}

/* Responsive design */
@media (max-width: 1400px) {
    .ads-panel {
        display: none;
    }
    .main-content {
        gap: 0; /* Odstranit gap, pokud ads panel zmiz√≠ */
    }
    .editor-container {
        border-radius: var(--border-radius-lg); /* Zaoblen√© rohy */
    }
    .preview-container {
         border-radius: var(--border-radius-lg); /* Zaoblen√© rohy */
    }
}

@media (max-width: 1200px) {
    .main-content {
        flex-direction: column;
        height: calc(100vh - var(--top-nav-height));
        gap: 16px; /* P≈ôid√°n gap mezi panely */
    }
    
    .editor-container {
        min-height: 300px;
        height: 50%;
        flex-direction: column; /* Prompt panel nad code panelem */
        border-radius: var(--border-radius-lg); /* Zaoblen√© rohy */
    }

    .prompt-left {
        flex: none; /* Zru≈°it flex-basis */
        height: 150px; /* Pevn√° v√Ω≈°ka pro prompt panel */
        min-height: 100px;
        max-height: 200px;
        border-right: none; /* Zru≈°it prav√Ω border */
        border-bottom: 1px solid var(--glass-border); /* P≈ôidat spodn√≠ border */
        padding: 12px 20px; /* Upravit padding */
    }

    .prompt-input-container {
        flex: none; /* Zru≈°it flex-grow */
        height: 100%; /* Pln√° v√Ω≈°ka rodiƒçe */
        min-height: 0;
    }
    
    .prompt-input {
        height: 100%; /* Pln√° v√Ω≈°ka kontejneru */
    }

    .prompt-buttons {
        justify-content: flex-start; /* Tlaƒç√≠tka vlevo */
        margin-top: 8px; /* Mezera pod inputem */
    }
    
    .code-panel {
        flex: 1; /* Code panel zabere zbytek m√≠sta */
        min-height: 0;
    }
    
    .preview-container {
        min-height: 300px;
        height: 50%;
        border-radius: var(--border-radius-lg); /* Zaoblen√© rohy */
    }

    .resize-bar {
        display: none; /* Skr√Ωt vertik√°ln√≠ resize bar */
    }
}

@media (max-width: 768px) {
    :root {
        --sidebar-width: 50px;
        --top-nav-height: 50px;
    }
    
    .logo h1 {
        display: none;
    }
    
    .model-name {
        display: none;
    }
    
    .prompt-btn span {
        display: none;
    }
    
    .topbar-selectors {
        gap: 8px;
    }
    
    .model-display, .prompt-display {
        min-width: 100px; /* Men≈°√≠ min-width */
        padding: 6px 12px; /* Men≈°√≠ padding */
    }

    .settings-btn, .user-avatar {
        width: 32px;
        height: 32px;
    }
}

@media (max-width: 480px) {
    :root {
        --sidebar-width: 0;
    }
    
    .sidebar {
        display: none;
    }
    
    .app-container {
        grid-template-areas:
            "top-nav top-nav"
            "main main";
        grid-template-columns: 1fr;
        grid-template-rows: var(--top-nav-height) calc(100vh - var(--top-nav-height));
    }
    
    .main-content {
        padding: 8px;
        gap: 8px; /* Men≈°√≠ gap */
    }
    
    .editor-container, .preview-container {
        border-radius: var(--border-radius-md); /* Men≈°√≠ zaoblen√≠ */
    }

    .prompt-left {
        height: 120px; /* Je≈°tƒõ men≈°√≠ v√Ω≈°ka prompt panelu */
        padding: 8px 12px; /* Men≈°√≠ padding */
    }

    .prompt-buttons {
        gap: 8px; /* Men≈°√≠ mezera mezi tlaƒç√≠tky */
    }

    .prompt-btn {
        padding: 8px 12px; /* Men≈°√≠ padding tlaƒç√≠tek */
    }

    .editor-tabs {
        padding: 6px 12px 0; /* Men≈°√≠ padding tab≈Ø */
    }

    .filename {
        padding: 6px 12px; /* Men≈°√≠ padding n√°zv≈Ø soubor≈Ø */
        font-size: 0.8rem;
    }

    .preview-header {
        padding: 8px 12px; /* Men≈°√≠ padding preview headeru */
    }

    .preview-header h3 {
        font-size: 0.8rem;
    }

    .preview-controls {
        gap: 4px; /* Men≈°√≠ mezera mezi preview controls */
    }

    .preview-control-btn {
        width: 24px;
        height: 24px;
    }

    .modal-content {
        width: 95%; /* Vƒõt≈°√≠ ≈°√≠≈ôka modalu na mal√Ωch obrazovk√°ch */
        border-radius: var(--border-radius-md);
    }

    .modal-header {
        padding: 16px 20px; /* Men≈°√≠ padding modal headeru */
    }

    .modal-header h2 {
        font-size: 1rem;
    }

    .modal-body {
        padding: 20px; /* Men≈°√≠ padding modal body */
    }

    .modal-footer {
        padding: 16px 20px; /* Men≈°√≠ padding modal footeru */
    }

    .btn {
        padding: 8px 12px; /* Men≈°√≠ padding tlaƒç√≠tek v modalech */
        font-size: 0.875rem;
    }

    .text-input, .number-input, .prompt-textarea {
        padding: 8px 10px; /* Men≈°√≠ padding input≈Ø */
        font-size: 0.875rem;
    }

    .prompt-manager-toolbar, .add-model-form {
        flex-direction: column; /* Sloupce na mal√Ωch obrazovk√°ch */
        gap: 8px;
    }

    .prompt-manager-toolbar .btn, .add-model-form .btn {
        width: 100%; /* Tlaƒç√≠tka na celou ≈°√≠≈ôku */
        justify-content: center;
    }

    .prompt-editor-header {
        flex-direction: column;
        gap: 8px;
        align-items: stretch;
    }

    .prompt-editor-actions {
        margin-left: 0;
        justify-content: stretch;
        width: 100%;
    }

    .prompt-editor-actions .btn {
        flex-grow: 1;
        justify-content: center;
    }
}


/* Utility classes */
.hidden {
    display: none !important;
}

/* Accessibility */
@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
        scroll-behavior: auto !important;
    }
}

/* Focus styles */
button:focus-visible,
input:focus-visible,
textarea:focus-visible {
    outline: 2px solid var(--accent-orange); /* Oran≈æov√Ω focus */
    outline-offset: 2px;
}"

## Agents Used
- appmaker (anthropic/claude-sonnet-4)

## Files
- index.html: Main HTML structure
- style.css: Styling
- script.js: JavaScript functionality
